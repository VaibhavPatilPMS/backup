vsa-revamp-admin/src/models/accidenttypes.model.js
// accidenttypes-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "accidenttypes";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      accidentType: { type: String, required: true },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/activitation-types.model.js
// activitationTypes-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "activitationtypes";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      name: { type: String, required: true },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/categories.model/js
// categories-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "categories";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      categoryCode: { type: String, required: true },
      categoryName: { type: String, required: true },
      documentVersionNumber: { type: String, required: false },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
      isActive: { type: Boolean, default: true },
    },
    {
      timestamps: true,
    },
    {
      collation: { locale: "en", strength: 2 }, // Case-insensitive collation
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  // schema.index({ categoryName: 1 }, { unique: true, collation: { locale: 'en', strength: 2 } });
  schema.index(
    { categoryName: 1, isActive: 1 },
    { unique: true, partialFilterExpression: { isActive: true } }
  );
  schema.index(
    { categoryCode: 1, isActive: 1 },
    { unique: true, partialFilterExpression: { isActive: true } }
  );
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/checklistdetails.model.js
// checklistdetails-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "checklistdetails";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      checklistCode: { type: String, required: true },
      checklistDetailsCode: { type: String, required: true, unique: true },
      bannerImage: {
        type: new mongooseClient.Schema({
          _id: false,
          fieldname: String,
          originalname: String,
          encoding: String,
          mimetype: String,
          destination: String,
          filename: String,
          path: String,
          size: Number,
          imageStaticURL: String,
        }),
      },
      sections: [
        {
          _id: false,
          name: { type: String },
          sectionCode: { type: String },
          checkpoints: [
            {
              _id: false,
              checkPoint: { type: String },
              checkPointCode: { type: String },
              isMandatory: { type: Boolean, default: false },
              refImage: {
                type: new mongooseClient.Schema({
                  _id: false,
                  fieldname: String,
                  originalname: String,
                  encoding: String,
                  mimetype: String,
                  destination: String,
                  filename: String,
                  path: String,
                  size: Number,
                  imageStaticURL: String,
                }),
              },
              responseFields: [
                {
                  _id: false,
                  type: { type: String },
                  label: { type: String },
                  isMandatory: { type: Boolean },
                  defaultValue: { type: String },
                  placeHolder: { type: String },
                  options: [{ type: String }],
                  responseFieldCode: { type: String },
                  scoring: [{ type: Number, default: 0 }],
                },
              ],
            },
          ],
        },
      ],
      status: { type: String, required: true },
      version: { type: String },
      versionPublishedDate: { type: Date },
      parentVersion: { type: String },
      createdBy: {
        type: {
          id: {
            type: Schema.Types.ObjectId,
            ref: "users",
          },
          firstName: { type: String },
          lastName: { type: String },
          profilePic: {
            type: {},
            default: {},
          },
          designation: { type: String },
        },
      },
      updatedBy: {
        type: {
          id: {
            type: Schema.Types.ObjectId,
            ref: "users",
          },
          firstName: { type: String, required: true },
          lastName: { type: String, required: true },
          profilePic: {
            type: {},
            default: {},
          },
          designation: { type: String, required: true },
        },
      },
      secondaryLogo: {},
      legalEntityName: { type: String },
    },

    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/checklistrejectionreasons.model.js
// checklistrejectionreasons-model.js - A mongoose model
// 
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = 'checklistrejectionreasons';
  const mongooseClient = app.get('mongooseClient');
  const { Schema } = mongooseClient;
  const schema = new Schema({
    checklistrejectreason: { type: String, required: true },
    createdBy: { type: Schema.Types.ObjectId, ref: 'users' },
    updatedBy: { type: Schema.Types.ObjectId, ref: 'users' },
  }, {
    timestamps: true
  });

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
  
};

vsa-revamp-admin/src/models/checklists.model.js
// checklists-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "checklists";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      name: { type: String, required: true, unique: false },
      checklistCode: { type: String, unique: true },
      documentNumber: { type: String, required: true },
      moduleName: { type: String },
      activationtypes: {
        type: [
          {
            label: {
              type: String,
            },
            value: {
              type: String,
            },
          },
        ],
      },
      newChecklistType: { type: String }, // adding for checklist and form Template visiblity
      scoringEnabled: { type: Boolean, default: false },
      description: { type: String },
      isActive: { type: Boolean, default: true },
      version: { type: String },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
    },
    {
      timestamps: true,
    }
  );

  // schema.index(
  //   { name: 1 },
  //   { unique: true, collation: { locale: "en", strength: 2 } }
  // );
  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/checklistsetting.model.js
// checklistsettings-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "checklistsettings";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      groupCode: { type: String },
      groupName: {
        type: String,
        maxlength: [
          30,
          "Group Name should be less than or equal to 30 characters",
        ],
      },
      spotChecklistCode: { type: String, required: false },
      isOtherRepresentativeAllowed: { type: Boolean },
      isReviewerAllowed: { type: Boolean },

      isAllowSubmissionAfterDueDate: { type: Boolean },
      reviewers: {
        type: [{}],
        required: true,
      },
      toBeAnsweredBy: {
        type: [{}],
        required: true,
      },
      fromDate: { type: Date, required: true },
      toDate: { type: Date, required: true },
      scheduleFrequency: {
        type: String,
        enum: ["Daily", "Monthly", "Weekly", "Weekdays"],
        required: true,
      },
      scheduleDetails: { type: [] },
      checklistCode: { type: String },
      checklistName: { type: String },
      checklistDetailsCode: { type: String },
      checklistVersion: { type: String },
      activeVersionPublishedDate: { type: Date },
      documentNo: { type: String },
      assignmentMode: {
        type: String,
        enum: ["Same Project", "Other Project(Round Robin)"],
      },
      reviewerLogic: {
        type: String,
        enum: ["fixed", "submitter", "none"],
      },
      completionLogic: {
        type: String,
        enum: ["all", "one"],
      },
      numberOfDays: { type: Number, default: 0 },
      makeFormReviewerMandatory: { type: Boolean },
      moduleName: { type: String },
      activationtypes: {
        type: [
          {
            label: {
              type: String,
            },
            value: {
              type: String,
            },
          },
        ],
      },
    },
    {
      timestamps: true,
    }
  );
  schema.index(
    { projectId: 1, groupName: 1, checklistCode: 1 },
    { unique: true, collation: { locale: "en", strength: 2 } }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/clients.model.js
// clients-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "clients";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      clientCode: { type: String, required: true, unique: true },
      profilePhoto: {},
      firstName: { type: String, required: true },
      lastName: { type: String, required: true },
      contactNumber: { type: String, required: true },
      gender: {
        type: String,
        enum: {
          values: ["MALE", "FEMALE", "OTHER"],
        },
      },
      bloodGroup: { type: String },
      address: { type: String, required: true },
      emergencyContactName: { type: String, required: true },
      emergencyContactNumber: { type: String, required: true },
      emergencyContactRelation: {
        type: String,
        required: true,
        ref: "relationships",
      },
      // idProofType:{ type: String ,required:true, ref : " idprooftypes"},
      idProofType: [
        {
          _id: false,
          idProofType: { type: String },
          idProofCode: { type: String },
          idProofNumber: { type: String },
          idProofValidity: { type: String },
        },
      ],

      idProofPhotos: [{}],
      aadhaarNumber: {
        type: String,
        required: false,
        // unique: true,
        // partialFilterExpression: { aadhaarNumber: { $exists: true } },
        // index: 1,
      },
      isActive: { type: Boolean, required: true, default: true },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
    },
    {
      timestamps: true,
    }
  );

  schema.index(
    { aadhaarNumber: 1 },
    {
      unique: true,
      partialFilterExpression: { aadhaarNumber: { $exists: true } },
    }
  );
  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/configurable-safety-dashboard.model.js
// configurable-safety-dashboard-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "configurableSafetyDashboard";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;

  const KpiItemSchema = new Schema(
    {
      position: { type: Number, required: true },
      kpiName: { type: String, required: true },
      kpiCode: { type: String, required: true },
    },
    { _id: false } // no separate _id for each array item
  );

  const schema = new Schema(
    {
      metricCode: { type: String, required: true, unique: true },
      metricName: { type: String, required: true },
      kpiSequence: { type: [KpiItemSchema], default: [] },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/configurations.model.js
// configurations-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "configurations";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      configurationTypeCode: {
        type: String,
        ref: "configurationTypeCode",
        required: true,
      },
      configurationCode: {
        type: String,
        required: true,
      },
      configuration: {
        lable: { type: String },
        type: { type: String },
        value: { type: Boolean },
        options: { type: [] },
      },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
      isActive: { type: Boolean, default: true },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/configurationtypes.model.js
// configurationtypes-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "configurationtypes";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      name: { type: String, required: true },
      configurationTypeCode: {
        type: String,
        required: true,
      },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
      isActive: { type: Boolean, default: true },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/consultants.model.js
// consultants-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "consultants";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      consultantCode: { type: String, required: true, unique: true },
      firstName: { type: String, required: true },
      lastName: { type: String, required: true },
      contactNumber: { type: String, required: true },
      profilePhoto: {},
      gender: {
        type: String,
        enum: {
          values: ["MALE", "FEMALE", "OTHER"],
        },
      },
      bloodGroup: { type: String },
      address: { type: String, required: true },
      emergencyContactName: { type: String, required: true },
      emergencyContactNumber: { type: String, required: true },
      emergencyContactRelation: {
        type: String,
        required: true,
        ref: "relationships",
      },
      // idProofType:{ type: String ,required:true, ref : " idprooftypes"},
      idProofType: [
        {
          _id: false,
          idProofType: { type: String },
          idProofCode: { type: String },
          idProofNumber: { type: String },
          idProofValidity: { type: String },
        },
      ],
      idProofPhotos: [{}],
      aadhaarNumber: {
        type: String,
        required: false,
        // unique: true,
        // partialFilterExpression: { aadhaarNumber: { $exists: true } },
        // index: 1,
      },
      isActive: { type: Boolean, required: true, default: true },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
    },
    {
      timestamps: true,
    }
  );
  schema.index(
    { aadhaarNumber: 1 },
    {
      unique: true,
      partialFilterExpression: { aadhaarNumber: { $exists: true } },
    }
  );
  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/contractorfirms.model.js
// contractorfirms-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "contractorfirms";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      contractorFirmName: {
        type: String,
        required: true,
        maxLength: 50,
      },
      violationCount: { type: Number, default: 0 },
      projectsViolationCount: [
        {
          _id: false,
          projectCode: { type: Schema.Types.String, ref: "projects" },
          violationCount: { type: Number, default: 0 },
        },
      ],
      ctContactNumber: {
        type: String,
        required: true,
        minLength: 10,
        maxLength: 10,
      },
      contractorFirmCode: { type: String, required: true, unique: true },
      contractorGroup: {
        type: new Schema({
          _id: false,
          contractorGroupName: {
            type: String,
          },
          groupContactNumber: {
            type: String,
          },
          groupEmailId: {
            type: String,
          },
        }),
      },
      gstInNumber: { type: String, minLength: 15, maxLength: 15 },
      emailId: { type: String, required: true },
      idProofType: { type: String },
      idProofNumber: { type: String },
      idProofPhotos: { type: [] },
      isActive: { type: Boolean, default: true },
      //  serviceArea: { type: String, required: true },
      serviceAreas: {
        type: [
          {
            type: new Schema({
              _id: false,
              name: {
                type: String,
                require: true,
              },
            }),
          },
        ],
        validate: {
          validator: function (v) {
            return v && v.length > 0;
          },
          message: "Add service areas",
        },
      },
      otherServiceArea: { type: String },
      primaryContactPersonName: { type: String, required: true },
      contractorServiceTypes: [
        {
          _id: false,
          serviceType: { type: String },
          serviceCode: { type: String },
          secondaryContactDetails: [
            {
              _id: false,
              secondaryContactPersonName: { type: String },
              secondaryContactPersonNumber: { type: String },
            },
          ],
        },
      ],
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
    },
    {
      timestamps: true,
    }
  );

  schema.index(
    { contractorFirmName: 1, ctContactNumber: 1 },
    { unique: true, collation: { locale: "en", strength: 2 } }
  );
  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/contractorfirmworkorders.model.js
// contractorfirmworkorders-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "contractorfirmworkorders";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      contractorFirmCode: { type: String, required: true },
      projectCode: { type: String },
      workOrders: {
        type: [
          {
            _id: false,
            documentCode: { type: String },
            documents: { type: [] },
            documentName: { type: String },
            documentExpiryDate: { type: Date },
            notifyEmailRecipients: {
              type: [
                {
                  _id: false,
                  recipientId: { type: Schema.Types.ObjectId, ref: "users" },
                  recipientFirstName: { type: String },
                  recipientLastName: { type: String },
                  recipientDesignation: { type: String },
                  recipientProfile: {},
                  recipientContactNo: { type: String },
                },
              ],
            },
            reminderCount: { type: String },
            gapIndays: { type: String },
          },
        ],
      },

      currentActivationStatus: {
        type: {
          isActive: { type: Boolean, default: true },
          reasonOfDeactivation: { type: String },
          remark: { type: String },
          actionTakenBy: { type: Schema.Types.ObjectId, ref: "users" },
          actionTakenAt: { type: Date },
        },
        default: {
          isActive: true,
        },
      },
      activationStatusHistory: {
        type: [],
      },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
    },
    {
      timestamps: true,
    }
  );

  schema.pre("save", function (next) {
    if (!this.isNew) {
      return next();
    }

    this.currentActivationStatus.actionTakenAt = new Date(Date.now());
    next();
  });

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/contractorgroup.model.js
// contractorgroup-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "contractorgroups";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      contractorGroupName: { type: String, required: true },
      groupContactNumber: { type: String, required: true },
      groupEmailId: { type: String },
      groupContractors: {
        type: [
          {
            _id: false,
            contractorFirmCode: String,
          },
        ],
      },
    },
    {
      timestamps: true,
    }
  );

  schema.index(
    { contractorGroupName: 1, groupContactNumber: 1 },
    { unique: true, collation: { locale: "en", strength: 2 } }
  );
  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/contractors.model.js
// contractors-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "contractors";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      contractorCode: { type: String, required: true, unique: true },
      contractorFirmDetails: {
        type: new mongooseClient.Schema({
          _id: false,
          contractorFirm: String,
          contractorFirmCode: String,
          ctContactNumber: String,
          gstInNumber: String,
          isActive: Boolean,
        }),
      },
      profilePhoto: {},
      firstName: { type: String, required: true },
      lastName: { type: String, required: true },
      contactNumber: { type: String, required: true },
      gender: {
        type: String,
        enum: {
          values: ["MALE", "FEMALE", "OTHER"],
        },
      },
      bloodGroup: { type: String },
      address: { type: String, required: true },
      emergencyContactName: { type: String, required: true },
      emergencyContactNumber: { type: String, required: true },
      emergencyContactRelation: {
        type: String,
        required: true,
        ref: "relationships",
      },
      // idProofType: { type: String, required: true, ref: " idprooftypes" },
      idProofType: [
        {
          _id: false,
          idProofCode: { type: String },
          idProofType: { type: String },
          idProofNumber: { type: String },
          idProofValidity: { type: String },
        },
      ],
      idProofPhotos: [{}],
      contractorWorkOrderPhotos: { type: [] },
      aadhaarNumber: {
        type: String,
        required: false,
        // unique: true,
        // partialFilterExpression: { aadhaarNumber: { $exists: true } },
        // index: 1,
      },
      isActive: { type: Boolean, required: true, default: true },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
    },
    {
      timestamps: true,
    }
  );

  schema.index(
    { aadhaarNumber: 1 },
    {
      unique: true,
      partialFilterExpression: { aadhaarNumber: { $exists: true } },
    }
  );
  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/contractorservicetypes.model.js
// contractorservicetypes-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "contractorservicetypes";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      service: { type: String, required: true },
      serviceCode: { type: String },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
    },
    {
      timestamps: true,
    }
  );

  schema.index(
    { service: 1 },
    { unique: true, collation: { locale: "en", strength: 2 } }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/correctiveactions.model.js
const {
  CorrectiveActions,
} = require("../services/correctiveactions/correctiveactions.class");

module.exports = function (app) {
  const modelName = "correctiveactions";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      correctiveAction: { type: String, required: true },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/dashboardreportconfiguration.model.js
// dashboardreportconfiguration-model.js - A mongoose model
// 
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = 'dashboardreportconfiguration';
  const mongooseClient = app.get('mongooseClient');
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      username: {type: String,require: true, unique: true},
      monthly: { type: Boolean, require: true, default: false },
      weekly: { type: Boolean, require: true, default: false },
    }, {
    timestamps: true
  });

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
  
};

vsa-revamp-admin/src/models/dependantrelations.model.js
// dependantrelations-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "dependantrelations";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;

  // Define the schema with the 'name' and 'relationCode' fields
  const schema = new Schema(
    {
      // Display name (e.g., 'Spouse')
      name: {
        type: String,
        required: true,
        unique: true, // Ensures no duplicate names
      },
      // Internal code (e.g., 'SPOUSE')
      relationCode: {
        type: String,
        required: true,
        unique: true, // Ensures no duplicate codes
      },
    },
    {
      timestamps: true, // Automatically adds createdAt and updatedAt fields
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }

  // Register the model with Mongoose
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/designations.model.js
// designations-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "designations";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      designation: { type: String, required: true },
      createdBy: {
        type: {
          _id: false,
          id: { type: Schema.Types.ObjectId },
          firstName: { type: String, required: false },
          lastName: { type: String, required: false },
          profilePic: {},
          designation: { type: String, required: false },
          phoneNumber: { type: String, required: false },
        },
      },
      updatedBy: {
        type: {
          _id: false,
          id: { type: Schema.Types.ObjectId },
          firstName: { type: String, required: false },
          lastName: { type: String, required: false },
          profilePic: {},
          designation: { type: String, required: false },
          phoneNumber: { type: String, required: false },
        },
      },
    },
    {
      timestamps: true,
    }
  );
  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/emailconfigurations.model.js
// emailconfigurations-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "emailconfigurations";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      recordTypeEvent: new Schema({
        _id: false,
        recordType: { type: String },
        event: { type: String },
        eventDisplayName: { type: String },
        recordTypeDisplayName: { type: String },
      }),
      toEmails: [],
      subject: { type: String },
      content: { type: String },
      signature: { type: String },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/entitlements.model.js
// entitlements-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "entitlements";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      entitlementCode: { type: String, required: true, unique: true },
      entitlementName: { type: String, required: true, unique: true },
      moduleCode: { type: String, required: true },
      moduleName: { type: String, required: true },
      description: { type: String },
      applicablePermissions: {
        type: new Schema({
          _id: false,
          create: {
            enabled: { type: Boolean, required: true, default: false },
          },
          delete: {
            enabled: { type: Boolean, required: true, default: false },
          },
          update: {
            enabled: { type: Boolean, required: true, default: false },
          },
          read: { enabled: { type: Boolean, required: true, default: false } },
          download: {
            enabled: { type: Boolean, required: true, default: false },
          },
        }),
        required: true,
      },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/equipmenttypes.model.js
// equipmenttypes-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "equipmenttypes";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      equipment: { type: String, required: true },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/eventtypes.model.js
// eventtypes-model.js - A mongoose model
// 
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = 'eventtypes';
  const mongooseClient = app.get('mongooseClient');
  const { Schema } = mongooseClient;
  const schema = new Schema({
    text: { type: String, required: true }
  }, {
    timestamps: true
  });

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
  
};

vsa-revamp-admin/src/models/exportprojecthistory.model.js
module.exports = function (app) {
  const modelName = "exportprojecthistory";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema({
    projectCode: {
      type: String,
      required: true,
    },
    backupStatus: {
      type: String,
      required: true,
    },
    backupCreatedAt: { type: Date, default: Date.now },
    backupCompletedAt: { type: Date },
    clientCode: { type: String, required: true },
  });

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/governmentofficials.model.js
// governmentofficials-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "governmentofficials";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      governmentofficialCode: { type: String, required: true, unique: true },
      firstName: { type: String, required: true },
      lastName: { type: String, required: true },
      contactNumber: { type: String, required: true },
      profilePhoto: {},
      gender: {
        type: String,
        enum: {
          values: ["MALE", "FEMALE", "OTHER"],
        },
      },
      bloodGroup: { type: String },
      address: { type: String, required: true },
      emergencyContactName: { type: String, required: true },
      emergencyContactNumber: { type: String, required: true },
      emergencyContactRelation: {
        type: String,
        required: true,
        ref: "relationships",
      },
      // idProofType:{ type: String ,required:true, ref : " idprooftypes"},
      idProofType: [
        {
          _id: false,
          idProofCode: { type: String },
          idProofType: { type: String },
          idProofNumber: { type: String },
          idProofValidity: { type: String },
        },
      ],
      idProofPhotos: [{}],
      aadhaarNumber: {
        type: String,
        required: false,
        // unique: true,
        // partialFilterExpression: { aadhaarNumber: { $exists: true } },
        // index: 1,
      },
      isActive: { type: Boolean, required: true, default: true },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
    },
    {
      timestamps: true,
    }
  );

  schema.index(
    { aadhaarNumber: 1 },
    {
      unique: true,
      partialFilterExpression: { aadhaarNumber: { $exists: true } },
    }
  );
  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/idprooftypes.model.js
// idprooftypes-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "idprooftypes";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      title: { type: String, required: true },
      idProofCode: { type: String, required: true },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/incidentreportdocumentnumber.model.js
// incidentreportdocumentnumber-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "incidentreportdocumentnumber";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      incidentReportDocumentNumber: { type: String, required: false },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/induction-uniqueness-configuration.model.js
// induction-uniqueness-configuration-model.js - A mongoose model
// 
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = 'inductionUniquenessConfiguration';
  const mongooseClient = app.get('mongooseClient');
  const { Schema } = mongooseClient;
  const schema = new Schema({
    inductionUniquenessSetting: { type: String, required: true }
  }, {
    timestamps: true
  });

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
  
};

vsa-revamp-admin/src/models/inductioncategorydocuments.model.js
// inductioncategorydocuments-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "inductioncategorydocuments";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      categoryCode: {
        type: String,
        ref: "categories",
      },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
      documentObject: {},
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/inductiontraininginstructions.model.js
// inductiontraininginstructions-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "inductiontraininginstructions";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      instruction: { type: String, required: true },
      categoryCode: { type: String, ref: "categories" },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/inductiontrainingtrainingvideos.model.js
// inductiontrainingtrainingvideos-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "inductiontrainingtrainingvideos";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      videoLabel: { type: String, required: true },
      videoLink: { type: String, required: true },
      categoryCode: { type: String, ref: "categories" },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/injurybodyparts.model.js
// injurybodyparts-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "injurybodyparts";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      injurypart: { type: String, required: true },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/instructortypes.model.js
// instructortypes-model.js - A mongoose model
// 
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = 'instructortypes';
  const mongooseClient = app.get('mongooseClient');
  const { Schema } = mongooseClient;
  const schema = new Schema({
    text: { type: String, required: true }
  }, {
    timestamps: true
  });

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
  
};

vsa-revamp-admin/src/models/issuerisklevels.model.js
// issuerisklevels-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html

const trimStrings = require("../middleware/trimStrings");

// for more of what you can do here.
module.exports = function (app) {
  const modelName = "issuerisklevels";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      issueRisk: { type: String, required: true },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
      //hours storing in minutes
      hours: { type: Number, default: 0 },
    },
    {
      timestamps: true,
    }
  );
  schema.index(
    { issueRisk: 1 },
    {
      unique: true,
      collation: { locale: "en", strength: 2 },
    }
  );
  schema.plugin(trimStrings);
  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/labourcampaddress.model.js
// labourcampaddress-model.js - A mongoose model
module.exports = function (app) {
  const modelName = "labourcampaddress";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;

  const schema = new Schema(
    {
      address: {
        type: String,
        required: true,
      },
      projectCode: {
        type: String,
        required: true,
        unique: true, // <--- This ensures only one entry per projectCode
      },
      projectName: {
        type: String,
        required: true,
      },
      updatedBy: {
        userId: { type: Schema.Types.ObjectId, ref: "users" },
        name: { type: String },
        email: { type: String },
      },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/labourformfields.model.js
// labourformfields-model.js - A mongoose model
// 
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = 'labourformfields';
  const mongooseClient = app.get('mongooseClient');
  const { Schema } = mongooseClient;
  const schema = new Schema({
    fieldName: { type: String, required: true },
    isMandetory:{ type: Boolean, required: true },
    source:{type:String}
  }, {
    timestamps: true
  });

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
  
};

vsa-revamp-admin/src/models/labourprojects.model.js
// labourprojects-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "labourprojects";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      labourCode: { type: String, required: true },
      projectCode: { type: String, required: true },
      contractorFirmCode: { type: String, required: true },
      lastInductedOn: { type: Date, required: false },
      isActive: { type: Boolean, required: true, default: true },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/labours.model.js
module.exports = function (app) {
  const modelName = "labours";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;

  // Schema for fitness certificate details (already existing)
  const fitnessCertificateSchema = new Schema({
    fitnessCertificateCode: { type: String },
    fitnessCertificateName: { type: String },
    fitnessCertificateValidity: Date, // This field is non-mandatory
    fitnessCertificateAddedAt: Date,
    fitnessCertificateSource: { type: String },
    isLabourUnfit: { type: Boolean },
    fitnessCertificateDocuments: [{}],
    isExpired: { type: Boolean, default: false }, // Default value for isExpired
  });

  // NEW: Schema for a single Dependant
  const dependantSchema = new Schema(
    {
      dependantName: { type: String, required: true },
      dateOfBirth: { type: Date, required: true }, // Storing DOB as a Date object
      gender: { type: String, required: true },
      // Stores the selected relation name (e.g., "Spouse") from the dropdown
      relation: { type: String, required: true },
      otherRelation: { type: String, required: false },
      idProofType: { type: String, required: false },
      idProofNumber: { type: String, required: false },
      contactNumber: { type: String, required: false },
      accessCrecheSchooling: { type: Boolean, default: false },
    },
    { _id: false }
  ); // _id: false prevents Mongoose from creating an _id for each sub-document

  const schema = new Schema(
    {
      labourCode: {
        type: String,
        unique: true,
        required: true,
      },
      firstName: { type: String, required: true },
      middleName: { type: String },
      lastName: { type: String, required: true },
      contactNumber: { type: String, required: true },
      emergencyContactName: { type: String },
      emergencyContactNumber: { type: String },
      emergencyContactRelation: {
        type: String,
        ref: "relationships",
      },
      idProofPhotos: { type: [] },
      idProofType: [
        {
          _id: false,
          idProofCode: { type: String },
          idProofType: { type: String },
          idProofNumber: { type: String },
          idProofValidity: { type: String },
        },
      ],
      labourExperience: { type: Number },
      isActive: { type: Boolean, required: true, default: true },
      trades: {
        type: [
          {
            _id: false,
            tradeName: String,
            tradeCode: String,
            skillLevel: String,
          },
        ],
        validate: {
          validator: function (v) {
            return v && v.length > 0;
          },
        },
      },
      contractorFirmDetails: {
        type: [
          {
            contractorFirm: String,
            contractorFirmCode: String,
            ctContactNumber: String,
          },
        ],
        validate: {
          validator: function (v) {
            return v && v.length > 0;
          },
        },
      },
      violationCount: { type: Number, default: 0 },
      gender: {
        type: String,
        required: true,
      },
      isLiterate: { type: Boolean },
      aadhaarNumber: {
        type: String,
        default: null, // Allow null values
        index: {
          unique: true,
          partialFilterExpression: { aadhaarNumber: { $type: "string" } },
        },
        allowNull: true,
      },
      bloodGroup: {
        type: String,
      },

      // Field added for Dependant List
      dependants: {
        type: [dependantSchema], // Using the newly defined schema
        default: [],
      },

      // NEW FIELD FOR ADDRESS SELECTION
      currentAddressType: {
        type: String, // Stores the type: 'SAME_AS_PERMANENT', 'LABOUR_CAMP', or 'MANUAL_INPUT'
      },

      // 'address' field will store the actual address string, or the Camp ID/Name
      dateOfBirth: { type: Date },
      address: { type: String },

      // NEW FIELD FOR LABOUR CAMP QUARTER DETAILS
      labourCampQuarter: {
        type: {
          labourCampId: { type: Schema.Types.ObjectId }, // No ref
          quarterName: { type: String },
          labourCampProjectCode: { type: String }, // moved inside
          labourCampProjectName: { type: String }
        },
        default: null,
      },
      // labourCampProjectCode: { type: String },
      // Permanent address is now a single string (after migration)
      permanetAddress: {
        type: String, // Changed from nested object to simple string
      },

      // Rest of the existing fields
      pfNumber: { type: String },
      bocwNumber: { type: String },
      insuranceNumber: { type: String },
      insuranceType: { type: String },
      groupInsuranceLimit: { type: String },
      insuranceValidity: { type: Date },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
      isOffline: { type: Boolean, default: false },
      createdAtOffline: { type: Date },

      profilePhoto: {},
      uanNumber: { type: String },
      bankDetails: {
        bankName: { type: String },
        ifscNumber: { type: String },
        accountNumber: { type: String },
      },
      casteCategory: { type: String },
      maritalStatus: { type: String },
      isLabourUnfit: { type: Boolean },
      fitnessStatusChangeSource: { type: String }, //we are storing source project or Admin,  if project then project name
      validFitnessCertificateDetails: {
        type: [fitnessCertificateSchema],
        default: [], // Set as an empty array by default
      },
      expiredFitnessCertificateDetails: {
        type: [fitnessCertificateSchema],
        default: [], // Set as an empty array by default
      },
      updateHistory: {
        type: [
          {
            updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
            updatedAt: { type: Date, default: Date.now },
            changes: { type: Object },
            geolocation: { type: Object },
          },
        ],
        default: [],
      },
      campAssignHistory: {
        type: [
          {
            campAssignedDate: { type: Date },
            campLeavingDate: { type: Date },
            campName: { type: String },
            campId: { type: String },
            campProjectCode: { type: String },
            campProjectName: { type: String },
          },
        ],
        default: [],
      },
    },
    {
      timestamps: true,
    }
  );

  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/maker-checker-settings.model.js
module.exports = function (app) {
  const modelName = "maker-checker-settings";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      checker: {
        type: String,
        required: true,
      },
      maker: {
        type: String,
        required: true,
      },
      isActive: {
        type: Boolean,
        default: true,
      },
    },
    {
      timestamps: true,
    }
  );

  // Add compound index to prevent duplicate settings for the same module
  schema.index({ checker: 1, maker: 1 }, { unique: true });

  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/mobileotps.model.js
// mobileotps-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "mobileotps";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      mobileNumber: { type: String, required: true },
      otp: { type: String, required: true },
      otpExpiryDateAndTime: { type: Date, required: true },
      isExpired: { type: Boolean, required: true, default: false },
      isVerified: { type: Boolean, required: true, default: false },
      purpose: { type: String },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/module-name.model.js
// moduleName-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "modulenames";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      name: { type: String, required: true },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/natureinjurytypes.model.js
// natureinjurytypes-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "natureinjurytypes";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      natureOfInjury: { type: String, required: true },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/notifications.model.js
// notifications-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "notifications";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      recordTypeEvent: new Schema({
        _id: false,
        recordType: { type: String },
        event: { type: String },
        eventDisplayName: { type: String },
        recordTypeDisplayName: { type: String },
      }),
      notification: {
        type: String,
      },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/ocr.model.js
// ocr-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "ocr";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      projectCode: { type: String },
      createdBy: {},
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/ohsdocument.model.js
// ohsdocument-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "ohsdocument";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      documentName: { type: String, required: true },
      categoryName: { type: String, required: false },
      documentLink: { type: String, required: true },
      createdBy: {
        type: {
          id: {
            type: Schema.Types.ObjectId,
            ref: "users",
            required: true,
          },
          firstName: { type: String, required: true },
          lastName: { type: String, required: true },
        },
        required: true,
      },
      updatedBy: {
        type: {
          id: {
            type: Schema.Types.ObjectId,
            ref: "users",
            required: false,
          },
          firstName: { type: String, required: false },
          lastName: { type: String, required: false },
        },
        required: false,
      },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/othercategories.model.js
// othercategories-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "othercategories";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      othercategoryCode: { type: String, required: true, unique: true },
      profilePhoto: {},
      firstName: { type: String, required: true },
      lastName: { type: String, required: true },
      contactNumber: { type: String, required: true },
      gender: {
        type: String,
        enum: {
          values: ["MALE", "FEMALE", "OTHER"],
        },
      },
      bloodGroup: { type: String },
      address: { type: String, required: true },
      emergencyContactName: { type: String, required: true },
      emergencyContactNumber: { type: String, required: true },
      emergencyContactRelation: {
        type: String,
        required: true,
        ref: "relationships",
      },

      idProofType: [
        {
          _id: false,
          idProofType: { type: String },
          idProofCode: { type: String },
          idProofNumber: { type: String },
          idProofValidity: { type: String },
        },
      ],
      idProofPhotos: [{}],
      aadhaarNumber: {
        type: String,
        required: false,
        // unique: true,
        // partialFilterExpression: { aadhaarNumber: { $exists: true } },
        // index: 1,
      },

      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
    },
    {
      timestamps: true,
    }
  );
  schema.index(
    { aadhaarNumber: 1 },
    {
      unique: true,
      partialFilterExpression: { aadhaarNumber: { $exists: true } },
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/otps.model.js
// otps-model.js - A mongoose model
// 
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = 'otps';
  const mongooseClient = app.get('mongooseClient');
  const { Schema } = mongooseClient;
  const schema = new Schema({
    emailId: { type: String, required: true },
    otp: { type: String, required: true },
    otpExpiryDateAndTime: { type: Date, required: true },
    isExpired: { type: Boolean, required: true,default:false },
    purpose: { type: String },
  }, {
    timestamps: true
  });

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
  
};

vsa-revamp-admin/src/models/projectgroups.model.js
// projectgroups-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "projectgroups";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      projectgroupName: { type: String, required: true },
      groupCode: { type: String, required: true },
      username: { type: String, required: true },
      projects: [
        {
          _id: false,
          projectCode: { type: String, required: true },
          projectName: { type: String },
          isActive: { type: Boolean, default: true },
        },
      ],
      createdBy: {
        type: {
          _id: false,
          username: { type: String, required: true },
          firstName: { type: String, required: true },
          lastName: { type: String, required: true },
          profilePic: {},
          designation: { type: String, required: true },
          phoneNumber: { type: String },
        },
      },
      updatedBy: {
        type: {
          _id: false,
          username: { type: String, required: true },
          firstName: { type: String, required: true },
          lastName: { type: String, required: true },
          profilePic: {},
          designation: { type: String, required: true },
          phoneNumber: { type: String },
        },
      },
    },
    {
      timestamps: true,
    }
  );

  schema.index(
    { projectgroupName: 1, username: 1 }, // Defines the index on the 'name' field in ascending order (1)
    {
      unique: true, // Specifies that the values in the indexed field must be unique
      collation: {
        locale: "en", // Specifies the locale for the collation (English)
        strength: 2, // Specifies the strength of the collation (secondary)
      },
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/projectplandetails.model.js
// projectplandetails-model.js - A mongoose model
// 
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = 'projectplandetails';
  const mongooseClient = app.get('mongooseClient');
  const { Schema } = mongooseClient;
  const schema = new Schema({
    clientCode: { type: String, required: true },
    projectName: { type: String, required: true },
    projectCode: { type: String, required: true },
    currentPlan:{
      startDate: { type: Date, required: true },
      endDate: { type: Date, required: true},
    },
    upcommingPlan:{},
    isActive:{type:Boolean},
    createdBy: { type: Schema.Types.ObjectId, ref: "users" },
    updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
  }, {
    timestamps: true
  });

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
  
};

vsa-revamp-admin/src/models/projectplanexpiry.model.js
// projectplanexpiry-model.js - A mongoose model
// 
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = 'projectplanexpiry';
  const mongooseClient = app.get('mongooseClient');
  const { Schema } = mongooseClient;
  const schema = new Schema({
    projectCode: { type: String, required: true },
    projectName: { type: String, required: true },
    isNotify:{ type: Boolean, required: true,default:false },
    planExpiryDate:{ type: Date, required: true }
  }, {
    timestamps: true
  });

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
  
};

vsa-revamp-admin/src/models/projects.model.js
// projects-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "projects";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      projectCode: { type: String, required: true, unique: true },
      projectName: { type: String, required: true, unique: true },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/reasonsforvisit.model.js
// reasonsforvisit-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "reasonsforvisit";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      reason: { type: String, required: true },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/refresh-token.model.js
// refresh-token-model.js - A mongoose model
// 
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app)
{
  const modelName = 'refreshToken';
  const mongooseClient = app.get('mongooseClient');
  const { Schema } = mongooseClient;
  const schema = new Schema({
    userId: { type: mongooseClient.Schema.Types.ObjectId, ref: "users" },
    username: { type: String },
    refreshTokenJTI: { type: String },
  }, {
    timestamps: true
  });


  const { refreshTokenTTL } = app.get("authentication");

  schema.index(
    { createdAt: 1 },
    {
      expireAfterSeconds: Number(refreshTokenTTL)
    }
  )

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName))
  {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);

};

vsa-revamp-admin/src/models/relationships.model.js
// relationships-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "relationships";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      relationshipCode: {
        type: String,
        required: true,
      },
      relationship: { type: String, required: true },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/reportsecondarylogo.model.js
// reportsecondarylogo-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "reportsecondarylogo";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      secondaryLogo: {},
      projectCode: { type: String, required: true },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
      isActive: { type: Boolean, default: true },
      legalEntityName: { type: String },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/roles.model.js
// roles-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "roles";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      roleCode: { type: String, required: true },
      roleName: {
        type: String,
        required: true,
        unique: true,
        maxLength: 50,
        trim: true,
      },
      entitlementPermissions: [
        {
          _id: false,
          entitlementCode: String,
          entitlementName: String,
          moduleCode: String,
          moduleName: String,
          permissions: {
            _id: false,
            create: {
              _id: false,
              enabled: { type: Boolean, required: true, default: false },
              isAllowed: { type: Boolean, required: true, default: false },
            },
            delete: {
              _id: false,
              enabled: { type: Boolean, required: true, default: false },
              isAllowed: { type: Boolean, required: true, default: false },
            },
            update: {
              _id: false,
              enabled: { type: Boolean, required: true, default: false },
              isAllowed: { type: Boolean, required: true, default: false },
            },
            read: {
              _id: false,
              enabled: { type: Boolean, required: true, default: false },
              isAllowed: { type: Boolean, required: true, default: false },
            },
            download: {
              _id: false,
              enabled: { type: Boolean, required: true, default: false },
              isAllowed: { type: Boolean, required: true, default: false },
            },
          },
        },
      ],
      createdBy: {
        type: new mongooseClient.Schema({
          firstName: { type: String, required: true },
          lastName: { type: String, required: true },
        }),
      },
      updatedBy: {
        type: new mongooseClient.Schema({
          firstName: { type: String, required: true },
          lastName: { type: String, required: true },
        }),
      },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/rootcauses.model.js
// rootcauses-model.js - A mongoose model
// 
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = 'rootcauses';
  const mongooseClient = app.get('mongooseClient');
  const { Schema } = mongooseClient;
  const schema = new Schema({
    rootCauseCode: { type: String, required: true, unique: true },
    rootCause: { type: String, required: true, unique: true },
    subCauses: {
      type: [{ _id: false, subCause: { type: String } }],  //  need to confirm can we put here unique 
      default: []
    },
    createdBy: { type: Schema.Types.ObjectId, ref: 'users' },
    updatedBy: { type: Schema.Types.ObjectId, ref: 'users' },
  }, {
    timestamps: true
  });

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);

};

vsa-revamp-admin/src/models/safetyactionablecategories.model.js
// safetyactionablecategories-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
const trimStrings = require("../middleware/trimStrings");
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "safetyactionablecategories";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      safetyActionableCategory: { type: String, required: true },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
    },
    {
      timestamps: true,
    }
  );
  schema.index(
    { safetyActionableCategory: 1 },
    {
      unique: true,
      collation: { locale: "en", strength: 2 },
    }
  );
  schema.plugin(trimStrings);
  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/safetyactionabledocumentnumber.model.js
// safetyactionabledocumentnumber-model.js - A mongoose model
// 
// See http://mongoosejs.com/docs/models.html

const trimStrings = require("../middleware/trimStrings");

// for more of what you can do here.
module.exports = function (app) {
  const modelName = 'safetyactionabledocumentnumber';
  const mongooseClient = app.get('mongooseClient');
  const { Schema } = mongooseClient;
 const schema = new Schema(
    {
      safetyActionableDocumentNumber: { type: String, required: true },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
    },
    {
      timestamps: true,
    }
  );

   schema.index(
    { safetyActionableDocumentNumber: 1 },
    {
      unique: true,
      collation: { locale: "en", strength: 2 },
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
  
};

vsa-revamp-admin/src/models/safetyactionabletypes.model.js
// safetyactionabletypes-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html

const trimStrings = require("../middleware/trimStrings");

// for more of what you can do here.
module.exports = function (app) {
  const modelName = "safetyactionabletypes";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      safetyActionableType: { type: String, required: true },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
    },
    {
      timestamps: true,
    }
  );
  schema.index(
    { safetyActionableType: 1 },
    {
      unique: true,
      collation: { locale: "en", strength: 2 },
    }
  );
  schema.plugin(trimStrings);
  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/safetyequipments.model.js
// safetyequipments-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "safetyequipments";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      name: { type: String, required: true },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/scoring-dashboard-setting.model.js
// scoring-dashboard-setting-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "scoringDashboardSetting";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;

  const BandSchema = new Schema(
    {
      label: { type: String },
      from: { type: Number },
      to: { type: Number },
      color: { type: String },
    },
    { _id: false }
  );

  const ScoreBandSchema = new Schema(
    {
      name: { type: String },
      bands: { type: [BandSchema] },
    },
    { timestamps: true }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, ScoreBandSchema);
};

vsa-revamp-admin/src/models/selectedprojectsexcel.model.js
// selectedprojectsexcel-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "selectedprojectsexcel";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      moduleName: {
        type: [String],
        required: true,
      },
      projectCodes: {
        type: [String],
        required: true,
      },
      dateRange: {
        type: {
          from: {
            type: Date,
            required: true,
          },
          to: {
            type: Date,
            required: true,
          },
        },
        required: true,
      },
      status: {
        type: String,
        enum: ["InProgress", "Completed", "Failed"],
        default: "InProgress",
      },
    },
    {
      timestamps: true, // Automatically adds createdAt and updatedAt
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/serviceareas.model.js
// serviceareas-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "serviceareas";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      serviceArea: { type: String, required: true },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/severitylevels.model.js
// severitylevels-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "severitylevels";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      severityLevel: { type: String, required: true },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/sourceofobservations.model.js
// sourceofobservations-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html

const trimStrings = require("../middleware/trimStrings");

// for more of what you can do here.
module.exports = function (app) {
  const modelName = "sourceofobservations";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      sourceofObservation: { type: String, required: true },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
    },
    {
      timestamps: true,
    }
  );

  schema.index(
    { sourceofObservation: 1 },
    {
      unique: true,
      collation: { locale: "en", strength: 2 },
    }
  );
  schema.plugin(trimStrings);
  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/staffprojects.model.js
// staffprojects-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "staffprojects";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      staffCode: { type: String, required: true },
      projectCode: { type: String, required: true },
      contractorFirmCode: { type: String, required: false },
      isActive: { type: Boolean, required: true, default: true },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/staffs.model.js
// staffs-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "staffs";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      staffCode: { type: String, required: true, unique: true },
      firstName: { type: String, required: true },
      middleName: { type: String },
      lastName: { type: String, required: true },
      contactNumber: { type: String, required: true },
      profilePhoto: {},
      designation: { type: String },
      gender: {
        type: String,
        enum: {
          values: ["MALE", "FEMALE", "OTHER", ""],
        },
        message: "Invalid Gender",
        required: false,
      },
      staffJoiningDate: { type: Date, required: false },
      bloodGroup: { type: String },
      address: { type: String },
      emergencyContactName: { type: String },
      emergencyContactNumber: { type: String },
      type: { type: String, required: false },
      emergencyContactRelation: {
        type: String,
        ref: "relationships",
      },
      violationCount: { type: Number, default: 0 },
      idProofType: [
        {
          _id: false,
          idProofCode: { type: String },
          idProofType: { type: String },
          idProofNumber: { type: String },
          idProofValidity: { type: String },
        },
      ],
      idProofPhotos: [{}],
      aadhaarNumber: {
        type: String,
        required: false,
      },
      isActive: { type: Boolean, required: true, default: true },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
      contractorFirmDetails: {
        contractorFirmName: String,
        contractorFirmCode: String,
        ctContactNumber: String,
      },
      username: { type: String },
      isApplicationUser: { type: Boolean, required: false, default: false },
    },
    {
      timestamps: true,
    }
  );
  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/statuses.model.js
// statuses-model.js - A mongoose model
// 
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = 'statuses';
  const mongooseClient = app.get('mongooseClient');
  const { Schema } = mongooseClient;
  const schema = new Schema({
    status: { type: String, required: true },
    statusCode: { type: String, required: true, unique: true }
  }, {
    timestamps: true
  });

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);

};

vsa-revamp-admin/src/models/subscriptionhistory.model.js
// subscriptionhistory-model.js - A mongoose model
// 
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = 'subscriptionhistory';
  const mongooseClient = app.get('mongooseClient');
  const { Schema } = mongooseClient;
  const schema = new Schema({
    projectName: { type: String, required: true },
    projectCode: { type: String, required: true },
    planStartDate: { type: Date, required: true },
    planEndDate: { type: Date},
    isActive:{type:Boolean},
    remark:{ type: String},
    createdBy: { type: Schema.Types.ObjectId, ref: "users" },
    updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
  }, {
    timestamps: true
  });

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
  
};

vsa-revamp-admin/src/models/toolboxtrainingactivities.model.js
// toolboxtrainingactivities-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "toolboxtrainingactivities";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      activity: { type: String, required: true },
      toolboxDocumentVersionNumber: {
        type: String,
        required: false,
        trim: true,
        default: null,
      },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/toolboxtrainingactivitydocuments.model.js
// toolboxtrainingactivitydocuments-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "toolboxtrainingactivitydocuments";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      document: { type: String, required: false },
      activityID: {
        type: Schema.Types.ObjectId,
        ref: "toolboxtrainingactivities",
        required: true,
      },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
      documentObject: {},
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/toolboxtraininginstructions.model.js
// toolboxtraininginstructions-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "toolboxtraininginstructions";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      activityID: {
        type: Schema.Types.ObjectId,
        ref: "toolboxtrainingactivities",
        required: true,
      },
      instruction: { type: String, required: true },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/trades.model.js
// trades-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "trades";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      trade: { type: String, required: true },
      tradeCode: { type: String, required: true, unique: true },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/undertakings.model.js
// undertakings-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "undertakings";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;

  const schema = new Schema(
    {
      undertaking: { type: String, required: true },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
    },
    {
      timestamps: true,
    }
  );
  schema.index(
    { undertaking: 1 },
    {
      unique: true,
      collation: { locale: "en", strength: 2 },
    }
  );
  // Avoid model compilation errors in watch mode
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }

  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/users.model.js
//  users-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "users";
  const mongooseClient = app.get("mongooseClient");
  const schema = new mongooseClient.Schema(
    {
      firstName: { type: String, required: true },
      middleName: { type: String },
      lastName: { type: String, required: true },
      username: {
        type: String,
        required: true,
        unique: true,
      },
      email: { type: String, required: true },
      phoneNumber: { type: String, required: true },
      emergencyContactName: { type: String },
      emergencyContactRelation: { type: String },
      emergencyContactNumber: { type: String },
      isAdmin: { type: Boolean, required: true, default: false },
      profilePic: {
        type: new mongooseClient.Schema({
          _id: false,
          fieldname: String,
          originalname: String,
          encoding: String,
          mimetype: String,
          destination: String,
          filename: String,
          path: String,
          size: Number,
        }),
      },
      isActive: { type: Boolean, default: true },
      isActiveStatusDate: { type: Date, default: new Date() },
      createdBy: {
        type: new mongooseClient.Schema({
          firstName: { type: String, required: true },
          lastName: { type: String, required: true },
        }),
      },
      updatedBy: {
        type: new mongooseClient.Schema({
          firstName: { type: String, required: true },
          lastName: { type: String, required: true },
        }),
      },
      password: { type: String, required: true },
      temporaryPassword: { type: String },
      idProofType: { type: String },
      idProofNumber: { type: String },
      registrationTokens: { type: [String] },
      designation: { type: String },
      type: { type: String, enum: ["Internal", "External"], required: true },
      contractorFirm: {},
      organizationName: { type: String },
      projects: {
        type: [
          {
            _id: false,
            projectCode: { type: String, required: true },
            projectName: { type: String },
            roleCode: { type: String, required: true },
            roleName: { type: String },
            contractorFirmCode: { type: String },
            contractorFirmName: { type: String },
            lastupdateDate: { type: Date },
            isActive: { type: Boolean, default: true },
          },
        ],
        validate: {
          validator: function (projects) {
            const seen = new Set();
            for (const proj of projects) {
              const key = `${proj.projectCode}-${proj.roleCode}`;
              if (seen.has(key)) {
                return false;
              }
              seen.add(key);
            }
            return true;
          },
          message:
            "Project with same Role allocation already exists for this user.",
        },
      },

      isMobileOtpVerified: { type: Boolean, default: true },
      createdAt: { type: Date, default: Date.now },
      updatedAt: { type: Date },
    }

    // {
    //   timestamps: true,
    // }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/violationdocumentnumbers.model.js
// violationdocumentnumbers-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "violationdocumentnumbers";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      violationDocumentNumber: { type: String, required: false },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/violationseverity.model.js
// violationSeverity-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "violationSeverity";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      violationSeverity: { type: String, required: true },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/visitors.model.js
// visitors-model.js - A mongoose model
// 
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = 'visitors';
  const mongooseClient = app.get('mongooseClient');
  const { Schema } = mongooseClient;
  const schema = new Schema({
    visitorCode: { type: String, required: true },
    firstName:{ type: String, required: true,trim: true },
    lastName:{ type: String, required: true,trim: true },
    contactNumber:{ type: String, required: true,trim: true },
    projectCode :{ type: String, required: true },
    projectName:{ type: String, required: true },
    projectAddress:{type: String,trim: true},
    secondaryLogo:{},
    address:{ type: String,trim: true},
    scheduledDateAndTime:{type: Date, required: true},
    visitedDateAndTime:{type: Date},
    exitDateAndTime:{type: Date},
    reason:{type:String,trim: true},
    remark:{type:String,trim: true,  validate: {
      validator: function (v) {
        return v && v.length < 251
      },
      message: "max length 250",
    },},
    otherReason:{type:String,trim: true},
    emailId:{type:String, required: true},
    updatedBy:{type:String}
  }, {
    timestamps: true
  });

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
  
};

vsa-revamp-admin/src/models/visitreasons.model.js
// visitreasons-model.js - A mongoose model
// 
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = 'visitreasons';
  const mongooseClient = app.get('mongooseClient');
  const { Schema } = mongooseClient;
  const schema = new Schema({
    reason: { type: String, required: true }
  }, {
    timestamps: true
  });

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
  
};

vsa-revamp-admin/src/models/work_permit_hours.model.js
// work_permit_hours-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "workPermitHours";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      hoursLimit: { type: Number, required: true },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/workpermitcategories.model.js
// workpermitcategories-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html

// for more of what you can do here.
module.exports = function (app) {
  const modelName = "workpermitcategories";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      category: { type: String, required: true },
      workpermitDocumentVersionNumber: {
        type: String,
        required: false,
        trim: true,
        default: null,
      },
      categoryCode: { type: String, required: true },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
      projects: { type: [String] },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/workpermitdocumentsrequired.model.js
// workpermitdocumentsrequired-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "workpermitdocumentsrequired";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      document: { type: String, required: true },
      categoryID: {
        type: Schema.Types.ObjectId,
        ref: "workpermitcategories",
        required: true,
      },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
      documentObject: {},
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/workpermithazards.model.js
// workpermithazards-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "workpermithazards";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      hazard: { type: String, required: true },
      hazardCode: { type: String, required: true },
      categoryId: {
        type: Schema.Types.ObjectId,
        ref: "workpermitcategories",
        required: true,
      },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
    },
    {
      timestamps: true,
    }
  );

  schema.index(
    { hazard: 1, categoryId: 1 },
    { unique: true, collation: { locale: "en", strength: 2 } }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/workpermitppes.model.js
module.exports = function (app) {
  const modelName = "workpermitppes";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      ppe: { type: String, required: true },
      ppeCode: { type: String, required: true },
      categoryId: {
        type: Schema.Types.ObjectId,
        ref: "workpermitcategories",
        required: true,
      },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
    },
    {
      timestamps: true,
    }
  );
  schema.index(
    { ppe: 1, categoryId: 1 },
    { unique: true, collation: { locale: "en", strength: 2 } }
  );

  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/workpermitprecautions.model.js
module.exports = function (app) {
  const modelName = "workpermitprecautions";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      precaution: { type: String, required: true },
      precautionCode: { type: String, required: true },
      categoryId: {
        type: Schema.Types.ObjectId,
        ref: "workpermitcategories",
        required: true,
      },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
    },
    {
      timestamps: true,
    }
  );
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-admin/src/models/workpermittoolsandequipments.model.js
// workpermittoolsandequipments-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "workpermittoolsandequipments";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      tool: { type: String, required: true },
      toolAndEquipmentCode: { type: String, required: true },
      // description: {type:String,required: true},
      categoryId: {
        type: Schema.Types.ObjectId,
        ref: "workpermitcategories",
        required: true,
      },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};





-----------------------------------------------------------------------





vsa-revamp-project/src/models/answersheets.model.js
// answersheets-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "answersheets";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      projectId: { type: Schema.Types.ObjectId, required: true },
      answerSheetCode: { type: String, required: true },
      checklistName: { type: String, required: true },
      documentNumber: { type: String, required: true },
      checklistCode: { type: String, required: true },
      checklistDetailsCode: { type: String, required: true },
      moduleName: { type: String },
      sections: {
        type: [
          {
            type: new mongooseClient.Schema({
              _id: false,
              name: { type: String },
              sectionCode: { type: String },
              checkpoints: {
                type: [
                  {
                    type: new mongooseClient.Schema({
                      _id: false,
                      checkPoint: { type: String },
                      checkPointCode: { type: String },
                      isMandatory: { type: Boolean },
                      refImage: {},
                      comment: { type: String },
                      remark: { type: String },
                      responseFields: {
                        type: [
                          {
                            type: new mongooseClient.Schema({
                              _id: false,
                              type: { type: String },
                              label: { type: String },
                              isMandatory: { type: Boolean },
                              options: { type: [], default: [] },
                              scoring: { type: [Number], default: [] },
                              defaultValue: { type: String },
                              answer: Schema.Types.Mixed,
                              responseFieldCode: { type: String },
                            }),
                          },
                        ],
                      },
                    }),
                  },
                ],
              },
            }),
          },
        ],
      },
      bannerImage: {},
      status: { type: String }, //, required: true
      version: { type: String, required: true },
      parentVersion: { type: String, required: true },
      remark: { type: String },
      makersComment: { type: String },
      reviewersComment: { type: String },
      createdBy: {},
      updatedBy: {},
      reviewedBy: {},
      otherRepresentatives: [],
      isOffline: { type: Boolean, default: false },
      createdAtOffline: { type: Date },
      syncDateTime: { type: Date },
      rejectionReasons: [],
      checklistType: { type: String, enum: ["scheduled", "onDemand"] },
      checklistDueDate: { type: Date },
      reviewers: [],
      submittedOn: { type: Date },
      overdueSubmittedOn: { type: Date },
      approvedOn: { type: Date },
      deniedOn: { type: Date },
      secondaryLogo: {},
      legalEntityName: { type: String },
      isOtherRepresentativeAllowed: { type: Boolean },
      isReviewerAllowed: { type: Boolean },
      isAllowSubmissionAfterDueDate: { type: Boolean },
      reviewersHistory: [],
    },
    {
      timestamps: true,
    }
  );
  schema.index(
    { projectId: 1, answerSheetCode: 1 },
    { unique: true, collation: { locale: "en", strength: 2 } }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-project/src/models/checklistsettings.model.js
// checklistsettings-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "checklistsettings";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      projectId: { type: Schema.Types.ObjectId, required: true },
      groupCode: { type: String },
      groupName: {
        type: String,
        maxlength: [
          30,
          "Group Name should be less than or equal to 30 characters",
        ],
      },
      spotChecklistCode: { type: String, required: false },
      isOtherRepresentativeAllowed: { type: Boolean },
      isReviewerAllowed: { type: Boolean },
      isAllowSubmissionAfterDueDate: { type: Boolean }, // need to confirm with rohini
      reviewers: {
        type: [{}],
        required: true,
      },
      toBeAnsweredBy: {
        type: [{}],
        required: true,
      },
      fromDate: { type: Date, required: true },
      toDate: { type: Date, required: true },
      scheduleFrequency: {
        type: String,
        enum: ["Daily", "Monthly", "Weekly", "Weekdays"],
        required: true,
      }, //Daily , Monthly , Weekly
      scheduleDetails: { type: [] },
      checklistCode: { type: String },
      checklistName: { type: String },
      checklistDetailsCode: { type: String },
      checklistVersion: { type: String },
      activeVersionPublishedDate: { type: Date }, //added later
      documentNo: { type: String }, //added later
      moduleName: { type: String },
      activationtypes: {
        type: [
          {
            label: {
              type: String,
            },
            value: {
              type: String,
            },
          },
        ],
      },
      roundRobinDay: { type: Number, default: 0 },
      assigneeUserProjectId: { type: String },
      numberOfDays: { type: Number, default: 0 },
      assignmentMode: { type: String},
      isReviewersAddedBySubmitter: { type: Boolean, default: false },
      isReviewersAssignmentInSequence: { type: Boolean, default: false },
      completionLogic : { type: String  }
    },
    {
      timestamps: true,
    }
  );
  schema.index(
    {
      projectId: 1,
      groupName: 1,
      checklistCode: 1,
    },
    { unique: true, collation: { locale: "en", strength: 2 } }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-project/src/models/checklistuserconfigs.model.js
// checklistuserconfigs-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "checklistuserconfigs";
  const mongooseClient = app.get("mongooseClient");
  const sequentialIdMiddleware = require("../middleware/generatingSequentialIds");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      projectId: { type: Schema.Types.ObjectId, required: true },
      username: { type: String, required: true },
      checklistCode: { type: String, required: true },
      sequentialId: { type: Number },
      groupCode: { type: String, required: true },
      spotDetails: {
        type: {
          spotCode: { type: String, required: false },
          spotName: { type: String, required: false },
          groupCode: { type: String, required: false },
          groupName: { type: String, required: false },
        },
        required: false,
      },
      checklistName: { type: String, required: true },
      documentNo: { type: String, required: true },
      checklistDetailsCode: { type: String, required: true },
      version: { type: String, required: true },
      versionCreationDate: { type: Date },
      dueDate: { type: Date, required: true },
      answerSheetStatus: { type: String },
      answerSheetCode: { type: String },
      flgDraftAnswerSheet: { type: Boolean },
      reviewers: { type: [{}], required: true },
      checklistType: { type: String },
      submittedOn: { type: Date },
      overdueSubmittedOn: { type: Date },
      approvedOn: { type: Date },
      deniedOn: { type: Date },
      createdBy: {},
      updatedBy: {},
      isAnswersheetOffline: { type: Boolean },
      isOtherRepresentativeAllowed: { type: Boolean },
      isReviewerAllowed: { type: Boolean },
      isReassigned: { type: Boolean },
      isAllowSubmissionAfterDueDate: { type: Boolean },
      deletedOn: { type: Date },
      reasonOfDeletion: { type: String },
      checklistId: { type: String, required: true },
      deletedBy: {},
      isDeleted: { type: Boolean, default: false },
      moduleName: { type: String },
      activationtypes: {
        type: [
          {
            label: {
              type: String,
            },
            value: {
              type: String,
            },
          },
        ],
      },
      numberOfDays: { type: Number, default: 0 },
      isReviewersAssignmentInSequence : {type : Boolean, default: false}
    },
    {
      timestamps: true,
    }
  );
  schema.pre("save", sequentialIdMiddleware(mongooseClient, modelName));
  schema.index(
    { projectId: 1, checklistId: 1, username: 1 },
    { unique: true, collation: { locale: "en", strength: 2 } }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-project/src/models/configurations.model.js
// configurations-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "configurations";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      projectId: { type: Schema.Types.ObjectId, required: true },
      configurationTypeCode: {
        type: String,
        ref: "configurationTypeCode",
        required: true,
      },
      configurationCode: {
        type: String,
        required: true,
      },
      configuration: {
        lable: { type: String },
        type: { type: String },
        value: { type: Boolean },
        options: { type: [] },
      },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
      isActive: { type: Boolean, default: true },
    },
    {
      timestamps: true,
    }
  );
  schema.index(
    { projectId: 1, configurationCode: 1 },
    { unique: true, collation: { locale: "en", strength: 2 } }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-project/src/models/configurationtypes.model.js
// configurationtypes-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "configurationtypes";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      projectId: { type: Schema.Types.ObjectId, required: true },
      name: { type: String, required: true },
      configurationTypeCode: {
        type: String,
        required: true,
      },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
      isActive: { type: Boolean, default: true },
    },
    {
      timestamps: true,
    }
  );
  schema.index(
    { projectId: 1, configurationTypeCode: 1 },
    { unique: true, collation: { locale: "en", strength: 2 } }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-project/src/models/consents.model.js
// consents-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "consents";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      projectId: { type: Schema.Types.ObjectId, required: true },
      moduleName: { type: String, required: true },
      moduleCode: { type: String, required: true },
      deviceCode: { type: String, required: true },
      platformName: { type: String, required: true },
      consent: {
        type: [{}],
      },
      geolocation: {
        locationAddress: { type: String },
        latitude: { type: String },
        longitude: { type: String },
        altitude: { type: String },
      },
      createdBy: {},
      createdAt: { type: Date, default: Date.now },
      updatedAt: { type: Date },
    },

    // {
    //   timestamps: true,
    // }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-project/src/models/debitviolationdetails.model.js
// debitviolationdetails-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html

const sequentialIdByCaseCodeMiddleware = require("../middleware/sequentialIdByCaseCodeMiddleware");

// for more of what you can do here.
module.exports = function (app) {
  const modelName = "debitviolationdetails";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      projectId: { type: Schema.Types.ObjectId, required: true },
      sequentialId: { type: Number },
      caseCodeId: { type: String, required: true },
      isRaisedDebitNote: { type: Boolean, required: false },
      noticeCode: { type: String },
      status: { type: String },
      locationOfViolation: { type: String }, // location
      violationDocumentNumber: { type: String, required: false },
      violationDetails: { type: String }, // location
      raisedDebitDate: { type: Date },
      lastUpdateViolationHistory: {
        type: new mongooseClient.Schema({
          _id: false,
          id: {
            type: Schema.Types.ObjectId,
          },
          firstName: { type: String },
          lastName: { type: String },
          designation: { type: String },
          signature: {},
          signatureType: { type: String },
          datetime: { type: Date },
        }),
      },
      // contractorfirmLastUpdateHistory: {}, //it for update info while edit
      severityOfViolation: { type: String }, // notice taken by admin
      contractorFirmInfo: {
        type: new mongooseClient.Schema({
          _id: false,
          contractorfirmName: { type: String },
          ctContactNumber: { type: String },
          contractorFirmCode: { type: String },
          violationCount: { type: String },
          involvedPerson: [
            {
              type: new mongooseClient.Schema({
                _id: false,
                id: {
                  type: Schema.Types.ObjectId,
                },
                firstName: { type: String },
                lastName: { type: String },
                phoneNumber: { type: String },
                profilePic: {},
                violationCount: { type: String },
                category: { type: String },
                categoryUniqueCode: { type: String },
                designation: { type: String },
                trade: { type: String }
              }),
            },
          ],
          amount: { type: Number },
          remark: { type: String },
          comment: { type: String },
          action: { type: String },
          lastEditedByHistory: {},
        }),
      }, // contractor Info
      photos: {
        type: [
          {
            type: new mongooseClient.Schema({
              _id: false,
              fieldname: String,
              originalname: String,
              encoding: String,
              mimetype: String,
              destination: String,
              filename: String,
              path: String,
              size: Number,
            }),
          },
        ],
        default: [],
      }, // photos,
      receiverDetails: [
        {
          type: new mongooseClient.Schema({
            _id: false,
            id: {
              type: Schema.Types.ObjectId,
            },
            firstName: { type: String },
            lastName: { type: String },
            phoneNumber: { type: String },
            receiverType: { type: String },
            contractorfirm: { type: String },
            profilePic: {},
            designation: { type: String },
            userCode: { type: String },
            geolocation: {},
            receiverSignature: {},
            receiverSignatureType: { type: String },
            datetime: { type: Date },
          }),
        },
      ], //receivers
      attachedSafetyactionable: {
        type: new mongooseClient.Schema({
          _id: false,
          id: {
            type: Schema.Types.ObjectId,
          },
          safetyactionableCode: { type: String },
        }),
      }, // attached safetyactionables
      makerInfo: {
        type: new mongooseClient.Schema({
          _id: false,
          id: {
            type: Schema.Types.ObjectId,
          },
          firstName: { type: String },
          lastName: { type: String },
          phoneNumber: { type: String },
          contractorfirm: { type: String },
          profilePic: {},
          designation: { type: String },
          geolocation: {},
          makerSignature: {},
          makerSignatureType: { type: String },
          datetime: { type: Date },
        }),
      },
      checkersDetailsHistory: [
        {
          type: new mongooseClient.Schema({
            _id: false,
            id: {
              type: Schema.Types.ObjectId,
            },
            firstName: { type: String },
            lastName: { type: String },
            phoneNumber: { type: String },
            assignDebitNotecontractorfirm: { type: String },
            profilePic: {},
            designation: { type: String },
            geolocation: {},
            datetime: { type: Date },
            approverSignature: {},
            approverSignatureType: { type: String },
            action: { type: String },
            comment: { type: String },
            remark: { type: String },
          }),
        },
      ],
      secondaryLogo: {},
      legalEntityName: { type: String },
    },
    {
      timestamps: true,
    }
  );
  schema.pre(
    "save",
    sequentialIdByCaseCodeMiddleware(mongooseClient, modelName)
  );

  schema.index(
    { projectId: 1, noticeCode: 1 },
    { unique: true, collation: { locale: "en", strength: 2 } }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-project/src/models/deduplication-entries.model.js
// deduplication-entries-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "deduplicationentries";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      clientFormId: { type: String, required: true },
      recordId: { type: Schema.Types.ObjectId, required: true },
      projectId: { type: Schema.Types.ObjectId, required: true },
      moduleCode: { type: String, required: true },
    },
    {
      timestamps: true,
    }
  );
  schema.index(
    { projectId: 1, clientFormId: 1 },
    { unique: true, collation: { locale: "en", strength: 2 } }
  );
  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-project/src/models/emailconfigurations.model.js
// emailconfigurations-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "emailconfigurations";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      projectId: { type: Schema.Types.ObjectId, required: true },
      recordTypeEvent: new Schema({
        _id: false,
        recordType: { type: String },
        event: { type: String },
        eventDisplayName: { type: String },
        recordTypeDisplayName: { type: String },
      }),
      toEmails: [],
      subject: { type: String },
      content: { type: String },
      signature: { type: String },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-project/src/models/emergencycontacts.model.js
// emergencycontacts-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "emergencycontacts";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      projectId: { type: Schema.Types.ObjectId, required: true },
      name: { type: String, required: true },
      details: { type: String },
      contactNumberType: { type: String, required: true },
      contactNumber: { type: String, required: true },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-project/src/models/escalationmatrix.model.js
// escalationmatrix-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "escalationmatrix";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      projectId: { type: Schema.Types.ObjectId, required: true },
      escalationLevel: {
        type: String,
        enum: ["Level 1", "Level 2", "Level 3"],
        required: true,
      },
      users: {
        type: [
          {
            _id: false,
            userId: {
              type: Schema.Types.ObjectId,
              require: true,
              ref: "users",
            },
            firstName: { type: String, required: true },
            lastName: { type: String, required: true },
            designation: { type: String, required: true },
            email: { type: String, required: true },
          },
        ],
      },
      thresholdTime: {
        type: {
          h: { type: Number, required: true },
          m: { type: Number, required: true },
        },
        required: true,
      },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-project/src/models/events.model.js
// events-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "events";
  const sequentialIdMiddleware = require("../middleware/generatingSequentialIds");
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      projectId: { type: Schema.Types.ObjectId, required: true },
      eventCode: { type: String, required: true, unique: true },
      sequentialId: { type: Number },
      name: {
        type: String,
        required: true,
        trim: true,
      },
      type: { type: String, required: true, trim: true },
      description: {
        type: String,
        trim: true,
        validate: {
          validator: function (k) {
            return (
              k !== undefined &&
              k !== "undefined" &&
              k !== null &&
              k !== "null" &&
              k.trim() !== ""
            );
          },
          message:
            "Description must not be undefined, null, or an empty string",
        },
      },
      venue: {
        type: String,
        required: true,
        trim: true,
      },
      eventDate: { type: Date, required: true },
      eventStartTime: { type: Date, required: true },
      eventEndTime: { type: Date, required: true },
      targetGroup: {
        type: String,
        trim: true,
        validate: {
          validator: function (k) {
            return (
              k &&
              k.length < 36 &&
              k !== undefined &&
              k !== "undefined" &&
              k !== null &&
              k !== "null" &&
              k.trim() !== ""
            );
          },
          message:
            "max length 35 and targetGroup must not be undefined, null, or an empty string",
        },
      },
      instructors: {
        type: [
          {
            _id: false,
            name: {
              type: String,
              trim: true,
              required: false,
              validate: {
                validator: function (k) {
                  return !k || (k.length < 36 && k.trim() !== "");
                },
                message:
                  "max length 35 and Instructors name must not be undefined, null, or an empty string",
              },
            },
            company: {
              type: String,
              trim: true,
              validate: {
                validator: function (k) {
                  return (
                    k &&
                    k.length < 36 &&
                    k !== undefined &&
                    k !== "undefined" &&
                    k !== null &&
                    k !== "null" &&
                    k.trim() !== ""
                  );
                },
                message:
                  "max length 35 and company must not be undefined, null, or an empty string",
              },
            },
            contactNumber: {
              type: String,
              trim: true,
              validate: {
                validator: function (k) {
                  return (
                    k &&
                    k.length === 10 &&
                    k !== undefined &&
                    k !== "undefined" &&
                    k !== null &&
                    k !== "null" &&
                    k.trim() !== ""
                  );
                },
                message: "length should be 10",
              },
            },
            type: { type: String, required: true, trim: true },
          },
        ],
      },
      expectedNumberOfAttendees: { type: String, required: true, trim: true },
      reviewer: {
        type: {
          _id: false,
          username: { type: String, required: true },
          firstName: { type: String, required: true },
          lastName: { type: String, required: true },
          profilePic: {},
          designation: { type: String, required: true },
          phoneNumber: { type: String },
        },
        required: true,
      },
      attendees: {
        type: [
          {
            _id: false,
            firstName: { type: String, required: true, trim: true },
            middleName: { type: String, required: false, trim: true },
            lastName: { type: String, required: true, trim: true },
            contactNumber: { type: String, required: true, trim: true },
            attendeeCode: { type: String, required: true, trim: true },
            category: {
              type: String,
              required: true,
              enum: {
                values: ["STAFF", "LABOUR"],
              },
            },
            gender: {
              type: String,
              enum: {
                values: ["MALE", "FEMALE", "OTHER"],
              },
            },
            trade: { type: String, trim: true },
            skill: { type: String, trim: true },
            contractorFirm: {},
            profilePhoto: {},
            code: { type: String },
            type: { type: String },
            signatureType: { type: String },
            tarineeSignature: {
              filepath: { type: String },
              filename: { type: String },
            },
          },
        ],
        validate: {
          validator: function (value) {
            // If status is COMPLETED, check if attendees array length is more than zero
            if (this.status === "COMPLETED") {
              return Array.isArray(value) && value.length > 0;
            }
            // If status is other than COMPLETED, validation passes
            return true;
          },
          message: (props) =>
            `Attendees array length should be more than zero when status is COMPLETED`,
        },
      },
      outsideAttendees: {
        type: [{ type: String, trim: true }],
      },
      disscussionPoints: {
        type: String,
        trim: true,
        validate: {
          validator: function (v) {
            return v && v.length > 1 && v.length <= 2000;
          },
          message: "Discussion points must be between 2 and 2000 characters.",
        },
      },

      status: { type: String, trim: true }, // store empty string while status is started or scheduled
      photos: {
        type: [
          {
            type: new Schema({
              _id: false,
              fieldname: String,
              originalname: String,
              encoding: String,
              mimetype: String,
              destination: String,
              filename: String,
              path: String,
              size: Number,
            }),
          },
        ],
      },
      cancellationReason: {
        type: String,
        trim: true,
        validate: {
          validator: function (v) {
            return v && v.length < 2001;
          },
          message: "max length 2000",
        },
      },
      closingComment: {
        type: String,
        trim: true,
        validate: {
          validator: function (v) {
            return v && v.length < 2001;
          },
          message: "max length 2000",
        },
      },
      cancelledBy: {
        type: {
          _id: false,
          username: { type: String, required: true },
          firstName: { type: String, required: true },
          lastName: { type: String, required: true },
          profilePic: {},
          designation: { type: String, required: true },
          phoneNumber: { type: String },
          signature: {},
          geolocation: {
            locationAddress: { type: String },
            latitude: { type: String },
            longitude: { type: String },
            altitude: { type: String },
          },
        },
      },
      closedBy: {
        type: {
          _id: false,
          username: { type: String, required: true },
          firstName: { type: String, required: true },
          lastName: { type: String, required: true },
          profilePic: {},
          designation: { type: String, required: true },
          phoneNumber: { type: String },
          signature: {},
          geolocation: {
            locationAddress: { type: String },
            latitude: { type: String },
            longitude: { type: String },
            altitude: { type: String },
          },
        },
      },
      createdBy: {
        type: {
          _id: false,
          username: { type: String, required: true },
          firstName: { type: String, required: true },
          lastName: { type: String, required: true },
          profilePic: {},
          designation: { type: String, required: true },
          phoneNumber: { type: String },
          signature: {},
          geolocation: {
            locationAddress: { type: String },
            latitude: { type: String },
            longitude: { type: String },
            altitude: { type: String },
          },
        },
      },
      completedBy: {
        type: {
          _id: false,
          username: { type: String, required: true },
          firstName: { type: String, required: true },
          lastName: { type: String, required: true },
          profilePic: {},
          designation: { type: String, required: true },
          phoneNumber: { type: String },
          signature: {},
          geolocation: {
            locationAddress: { type: String },
            latitude: { type: String },
            longitude: { type: String },
            altitude: { type: String },
          },
        },
      },
      updatedBy: {
        type: {
          _id: false,
          username: { type: String, required: true },
          firstName: { type: String, required: true },
          lastName: { type: String, required: true },
          profilePic: {},
          designation: { type: String, required: true },
          phoneNumber: { type: String },
        },
        geolocation: {
          locationAddress: { type: String },
          latitude: { type: String },
          longitude: { type: String },
          altitude: { type: String },
        },
      },
      cancelledAt: { type: Date },
      closedAt: { type: Date },
      completedAt: { type: Date },
      secondaryLogo: {},
      legalEntityName: { type: String },
    },
    {
      timestamps: true,
    }
  );
  schema.pre("save", sequentialIdMiddleware(mongooseClient, modelName));
  schema.index(
    { projectId: 1, eventCode: 1 },
    { unique: true, collation: { locale: "en", strength: 2 } }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-project/src/models/generateexceldata.model.js
// generateexceldata-model.js - A mongoose model
// 
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = 'generateexceldata';
  const mongooseClient = app.get('mongooseClient');
  const { Schema } = mongooseClient;
  const schema = new Schema({
    text: { type: String, required: true }
  }, {
    timestamps: true
  });

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
  
};

vsa-revamp-project/src/models/geofencing.model.js
// geofencing-model.js - A mongoose model
// 
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = 'geofencing';
  const mongooseClient = app.get('mongooseClient');
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      projectId: { type: Schema.Types.ObjectId, required: true, unique: true },
      // Configuration data
      latitude: { type: Number },
      longitude: { type: Number },
      radius: { type: Number },
      baseAltitude: { type: Number },
      // Array of module statuses
      modules: [
        {
          type: new mongooseClient.Schema({
            _id: false,
            moduleName: { type: String, required: true },
            isActive: { type: Boolean, default: false }
          })
        }
      ],
      // Flag to check if configuration is set
      isConfigured: { type: Boolean, default: false }
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
  
};

vsa-revamp-project/src/models/inandout.model.js
// inandout-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "inandout";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      projectId: { type: Schema.Types.ObjectId, required: true },
      userCode: { type: String, required: true }, //uniqcode of inductee
      firstName: { type: String, required: true },
      lastName: { type: String, required: true },
      category: { type: String, required: true },
      time: { type: Date },
      action: { type: String, enum: ["IN", "OUT"] },
      workHours: { type: Number },
      workMinutes: { type: Number },
      contactNumber: { type: String },
      geolocation: {
        locationAddress: { type: String },
        latitude: { type: String },
        longitude: { type: String },
        altitude: { type: String },
      },
      workDate: { type: Date },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-project/src/models/incidents.model.js
// incidents-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html

// for more of what you can do here.
module.exports = function (app) {
  const modelName = "incidents";
  const mongooseClient = app.get("mongooseClient");
  const sequentialIdMiddleware = require("../middleware/generatingSequentialIds");
  const { Schema } = mongooseClient;

  const schema = new Schema(
    {
      projectId: { type: Schema.Types.ObjectId, required: true },
      status: { type: String },
      sequentialId: { type: Number },
      incidentReportDocumentNumber: { type: String, required: false },
      incidentPhotos: {
        type: [{}],
        validate: [
          (incidentPhotos) => {
            return incidentPhotos.length <= 5 && incidentPhotos.length > 0;
          },
          "{PATH} validation failed",
        ],
        required: true,
        default: [],
      },
      incidentDateAndTime: { type: Date, required: false },
      activity: { type: String, required: false },
      details: { type: String, required: true },
      isDeleted: { type: Boolean, default: false },
      reasonOfDeletion: { type: String },
      deletedOn: { type: Date },
      deletedBy: {},
      locationOfIncident: { type: String, required: true },
      // actionTaken: { type: String },
      // actionTaken: {
      //   type: [
      //     {
      //       _id: { type: Schema.Types.ObjectId, required: false },
      //       action: { type: String, required: true },
      //     },
      //   ],
      // }, // or: { type: Array, of: String }
      actionTaken: {
        type: {
          otherAction: {
            _id: { type: Schema.Types.ObjectId, required: true },
            action: { type: String, required: false }, // required at data level, not schema level
          },
          predefinedActions: [
            {
              _id: { type: Schema.Types.ObjectId, required: true },
              action: { type: String, required: false },
            },
          ],
        },
        validate: {
          validator: function (value) {
            const hasOtherAction = value?.otherAction?.action?.trim();
            const hasPredefinedActions =
              Array.isArray(value?.predefinedActions) &&
              value.predefinedActions.some((pa) => pa?.action?.trim());
            return hasOtherAction || hasPredefinedActions;
          },
          message:
            "At least one of 'otherAction' or 'predefinedActions' must be provided.",
        },
      },

      equipments: {
        type: [
          {
            equipment: { type: String },
          },
        ],
      },
      otherEquipment: { type: String },
      natureOfInjuries: {
        type: [
          {
            natureOfInjury: { type: String },
          },
        ],
      },
      otherNatureInjury: { type: String },

      typeOfAccidents: {
        type: [
          {
            accidentType: { type: String },
          },
        ],
      },
      otherAccidentType: { type: String },

      severityLevel: {
        type: String,
        required: true,
      },

      injuredPeople: {
        type: [
          {
            _id: false,
            id: {
              type: Schema.Types.ObjectId,
            },

            firstName: {
              type: String,
            },
            middleName: { type: String },
            lastName: {
              type: String,
            },
            profilePic: {
              type: {},
              default: {},
            },
            designation: { type: String }, // for user
            category: { type: String }, //for other than user
            contractorFirm: { type: String }, // for Labour and contractor
            witnessType: { type: String, required: true }, //witnessType : user/inductee
            phoneNumber: { type: String },
            bodyPartInjuries: {
              type: [{ bodyPartInjury: { type: String } }],
            },
            type: { type: String },
            otherBodyPartInjured: { type: String },
            lostTimeInjury: { type: Number },
          },
        ],
        required: true,
        default: [],
      },

      witnessesOfIncident: [
        {
          _id: false,
          witnessId: { type: Schema.Types.ObjectId }, //witnessId : userId or Inductee Id
          dateOfSubmission: { type: Date },
          remark: { type: String, required: false },
          // for details page
          firstName: { type: String, required: true },
          lastName: { type: String, required: true },
          profilePic: {
            type: {},
          },
          designation: { type: String }, // for user
          category: { type: String }, //for other than user
          contractorFirm: { type: String }, // for Labour and contractor
          locationOfSubmission: {
            type: {
              location_address: { type: String },
              latitude: { type: String },
              longitude: { type: String },
              altitude: { type: String },
            },
            required: true,
          },
          witnessSignature: {
            type: {},
            default: {},
          }, //fingerPrint image neet to store
          signatureType: { type: String },
          witnessType: { type: String, required: true }, //witnessType : user/inductee
          phoneNumber: { type: String },
        },
      ],

      otherWitnessesOfIncident: [
        {
          _id: false,
          profilePic: {
            type: {},
          },
          firstName: { type: String, required: true },
          lastName: { type: String, required: true },
          contactNumber: { type: String },
          dateOfSubmission: { type: Date },
          remark: { type: String, required: false },
          locationOfSubmission: {
            type: {
              location_address: { type: String },
              latitude: { type: String },
              longitude: { type: String },
              altitude: { type: String },
            },
            required: true,
          },
          witnessSignature: {
            type: {},
            default: {},
          }, //fingerPrint image need to store
          signatureType: { type: String },
        },
      ],

      rca: {
        type: {
          applicableRootCauses: [
            {
              subCauses: [
                {
                  subCause: String,
                },
              ],
              rootCause: { type: String },
              rootCauseCode: { type: String },
            },
          ],
          rcaBy: {
            type: {
              id: {
                type: Schema.Types.ObjectId,
                ref: "users",
              },
              firstName: { type: String },
              lastName: { type: String },
              profilePic: {
                type: {},
                default: {},
              },
              designation: { type: String },
              phoneNumber: { type: String },
            },
          },
          createdAt: { type: Date, default: Date.now() },
        },
        default: {},
      },

      rcaStatement: {
        type: {
          statement: {
            type: String,
          },
          recommendation: { type: String },
          statementReasons: {
            type: [
              {
                reason: {
                  type: String,
                },
                document: {
                  fieldname: { type: String },
                  originalname: { type: String },
                  encoding: { type: String },
                  mimetype: { type: String },
                  destination: { type: String },
                  filename: { type: String },
                  path: { type: String },
                  size: { type: Number },
                },
              },
            ],
            validate: [
              {
                validator: function (arr) {
                  return arr.length === 5;
                },
                message: "Exactly 5 reasons are required.",
              },
            ],
          },
          rcaBy: {
            type: {
              id: {
                type: Schema.Types.ObjectId,
                ref: "users",
              },
              firstName: { type: String },
              lastName: { type: String },
              profilePic: {
                type: {},
                default: {},
              },
              designation: { type: String },
              phoneNumber: { type: String },
              signature: {},
            },
          },
          createdAt: { type: Date, default: Date.now() },

          default: {},
        },
      },

      rcaBy: {
        type: {
          id: {
            type: Schema.Types.ObjectId,
            ref: "users",
          },
          firstName: { type: String },
          lastName: { type: String },
          profilePic: {
            type: {},
          },
          username: { type: String },
          designation: { type: String },
          phoneNumber: { type: String },
          geolocation: {},
          signature: {},
          signatureType: { type: String },
          createdAt: { type: Date, default: Date.now },
        },
      },

      preventiveActions: {
        type: {
          preventiveActionsDetails: [
            {
              _id: {
                type: Schema.Types.ObjectId,
              },
              sequenceNo: { type: String },

              details: {
                type: String,
                required: true,
              },

              completionDateAndTime: {
                type: Date,
                required: true,
              },
              responsiblePersonInput: { type: String },
              document: {},
              photo: {},
              responsiblePerson: {
                id: {
                  type: Schema.Types.ObjectId,
                  ref: "users",
                },
                firstName: { type: String, required: true },
                lastName: { type: String, required: true },
                profilePic: {
                  type: {},
                },
                designation: { type: String },
                phoneNumber: { type: String },
                username: { type: String },
                createdAt: { type: Date, default: Date.now },
                signature: {},
              },
              status: { type: String, default: "OPEN" },
            },
          ],

          actionBy: {
            id: {
              type: Schema.Types.ObjectId,
              ref: "users",
            },
            firstName: { type: String },
            lastName: { type: String },
            profilePic: {
              type: {},
              default: {},
            },
            designation: { type: String },
            phoneNumber: { type: String },
          },
          createdAt: { type: Date, default: Date.now },
        },
      },
      correctiveActions: {
        type: {
          correctiveActionsDetails: [
            {
              _id: {
                type: Schema.Types.ObjectId,
              },
              sequenceNo: { type: String },
              details: { type: String },
              predefinedActions: [
                {
                  predefinedAction: { type: String },
                },
              ],

              completionDateAndTime: { type: Date, required: true },
              responsiblePersonInput: { type: String },
              document: {},
              photo: {},
              responsiblePerson: {
                id: { type: Schema.Types.ObjectId, ref: "users" },
                firstName: { type: String, required: true },
                lastName: { type: String, required: true },
                profilePic: { type: {} },
                designation: { type: String },
                phoneNumber: { type: String },
                username: { type: String },
                createdAt: { type: Date, default: Date.now },
                signature: {},
                default: {},
              },
              status: { type: String, default: "OPEN" },
            },
          ],

          actionBy: {
            id: { type: Schema.Types.ObjectId, ref: "users" },
            firstName: { type: String },
            lastName: { type: String },
            profilePic: { type: {}, default: {} },
            designation: { type: String },
            phoneNumber: { type: String },
          },
          createdAt: { type: Date, default: Date.now },
          default: {},
        },
      },

      capaBy: {
        id: {
          type: Schema.Types.ObjectId,
          ref: "users",
        },
        firstName: { type: String },
        lastName: { type: String },
        profilePic: {
          type: {},
        },
        designation: { type: String },
        phoneNumber: { type: String },
        geolocation: {},
        username: { type: String },
        signature: {},
        signatureType: { type: String },
        createdAt: { type: Date, default: Date.now },
      },

      rejectedBy: {
        id: {
          type: Schema.Types.ObjectId,
          ref: "users",
        },
        firstName: { type: String },
        lastName: { type: String },
        profilePic: {
          type: {},
        },
        designation: { type: String },
        phoneNumber: { type: String },
        geolocation: {},
        username: { type: String },
        remark: { type: String },
        createdAt: { type: Date, default: Date.now },
        signature: {},
        signatureType: { type: String },
      },

      approvedBy: {
        id: {
          type: Schema.Types.ObjectId,
          ref: "users",
        },
        firstName: { type: String },
        lastName: { type: String },
        profilePic: {
          type: {},
        },
        designation: { type: String },
        phoneNumber: { type: String },
        geolocation: {},
        username: { type: String },
        createdAt: { type: Date, default: Date.now },
        signature: {},
        signatureType: { type: String },
      },

      reviewBy: {
        id: {
          type: Schema.Types.ObjectId,
          ref: "users",
        },
        firstName: { type: String },
        lastName: { type: String },
        profilePic: {
          type: {},
        },
        designation: { type: String },
        phoneNumber: { type: String },
        geolocation: {},
        username: { type: String },
        createdAt: { type: Date, default: Date.now },
        signature: {},
        signatureType: { type: String },
        remark: { type: String },
      },
      siteEngineer: {
        type: [
          {
            id: {
              type: Schema.Types.ObjectId,
              ref: "users",
            },
            firstName: { type: String },
            lastName: { type: String },
            profilePic: {
              type: Object,
              default: {},
            },
            designation: { type: String },
            phoneNumber: { type: String },
            username: { type: String },
          },
        ],
        default: [], // Add this to ensure `siteEngineer` defaults to an empty array
      },

      safetyOfficer: {
        type: {
          id: {
            type: Schema.Types.ObjectId,
            ref: "users",
          },
          firstName: { type: String, required: true },
          lastName: { type: String, required: true },
          phoneNumber: { type: String },
          username: { type: String },

          profilePic: {
            type: {},
            default: {},
          },
          remark: { type: String },
          designation: { type: String },
          geolocation: {},
          signature: {},
          createdAt: { type: Date, default: Date.now },

          signatureType: { type: String },
        },
      },

      incidentDetailsHistory: {
        type: [{}],
      },

      contractorFirmDetails: [
        {
          type: new mongooseClient.Schema({
            _id: false,
            contractorFirm: { type: String },
            contractorFirmCode: { type: String },
            ctContactNumber: { type: String },
            gstInNumber: { type: String },
            emailId: { type: String },
          }),
        },
      ],

      createdBy: {
        type: {
          id: {
            type: Schema.Types.ObjectId,
            ref: "users",
          },
          firstName: { type: String },
          lastName: { type: String },
          profilePic: {
            type: {},
            default: {},
          },
          designation: { type: String },

          phoneNumber: { type: String },
          geolocation: {},
          signature: {},

          signatureType: { type: String },
          createdAt: { type: Date, default: Date.now },
        },
      },

      updatedBy: {
        type: {
          id: {
            type: Schema.Types.ObjectId,
            ref: "users",
          },
          firstName: { type: String, required: true },
          lastName: { type: String, required: true },
          username: { type: String },
          phoneNumber: { type: String },
          profilePic: {
            type: {},
            default: {},
          },
          designation: { type: String },
          geolocation: {},
          signature: {},
          signatureType: { type: String },
          createdAt: { type: Date, default: Date.now },
        },
      },

      incidentCode: { type: String },

      secondaryLogo: {},
      legalEntityName: { type: String },
    },
    {
      timestamps: true,
      minimize: false,
    }
  );
  schema.pre("save", sequentialIdMiddleware(mongooseClient, modelName));
  schema.index(
    { projectId: 1, incidentCode: 1 },
    { unique: true, collation: { locale: "en", strength: 2 } }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-project/src/models/inductiontrainings.model.js
// inductiontrainings-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "inductiontrainings";
  const mongooseClient = app.get("mongooseClient");
  const sequentialIdMiddleware = require("../middleware/generatingSequentialIds");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      projectId: { type: Schema.Types.ObjectId, required: true },
      inductionTrainingCode: { type: String, required: true },
      sequentialId: { type: Number },
      categoryDetails: {
        _id: false,
        id: { type: Schema.Types.ObjectId, required: true },
        categoryName: { type: String, required: true },
        categoryCode: { type: String, required: true },
        documentVersionNumber: { type: String, required: false },
      },
      trainingVideos: {
        type: [
          {
            _id: false,
            videoLabel: { type: String, required: true },
            videoLink: { type: String, required: true },
            categoryCode: { type: String, required: true },
          },
        ],
        required: false,
      },
      inducteeDetails: {}, // how it declare bcz it has dinamic data and it is required
      inducteeFirstName: { type: String, required: true },
      inducteeMiddleName: { type: String, required: false },
      inducteeLastName: { type: String, required: true },
      inducteeCode: { type: String, required: true },
      inducteeContactNumber: { type: String, required: true },
      staffJoiningDate: { type: Date, required: false },
      staffDesignation: { type: String, required: false },
      staffType: { type: String, required: false }, // internal or external
      trade: { type: String },
      skillLevel: { type: String },
      contractorFirmDetails: {},
      contractorWorkOrderPhotos: {
        type: [
          {
            //contractor workorderphoto
            type: new mongooseClient.Schema({
              _id: false,
              fieldname: String,
              originalname: String,
              encoding: String,
              mimetype: String,
              destination: String,
              filename: String,
              path: String,
              size: Number,
            }),
          },
        ],
      },
      safetyEquipments: {
        type: [
          {
            type: new mongooseClient.Schema({
              _id: false,
              id: { type: Schema.Types.ObjectId, required: true },
              name: { type: String, required: true },
            }),
          },
        ],
      },
      categoryDocuments: [{}], // selected category specific documents
      instructions: {
        type: [
          {
            type: new mongooseClient.Schema({
              _id: false,
              // id: { type: Schema.Types.ObjectId ,required:true},
              title: { type: String, required: true },
            }),
          },
        ],
      },
      reasonForVisit: { type: String, ref: "reasonforvisits" },
      undertakings: { type: [], default: [] },
      signature: { type: {} },
      signatureType: { type: String },
      geolocation: {
        type: new mongooseClient.Schema({
          _id: false,
          locationAddress: { type: String },
          latitude: { type: String },
          longitude: { type: String },
          altitude: { type: String },
        }),
      },
      isOffline: { type: Boolean, required: true, default: false },
      createdAtOffline: { type: Date },
      syncDateTime: { type: Date },
      isSignedByMakerBehalfOfInductee: {
        type: Boolean,
        required: true,
        default: false,
      },
      signatureOf: { type: String, default: null },
      createdBy: {
        type: new mongooseClient.Schema({
          _id: false,
          id: { type: Schema.Types.ObjectId, require: true, ref: "users" },
          firstName: { type: String, required: true },
          lastName: { type: String, required: true },
          designation: { type: String, required: true },
          phoneNumber: { type: String },
          profilePic: {
            type: new mongooseClient.Schema({
              _id: false,
              fieldname: String,
              originalname: String,
              encoding: String,
              mimetype: String,
              destination: String,
              filename: String,
              path: String,
              size: Number,
            }),
          },
        }),
      },
      // idcardvalidity: { type: Date },
      // idCardStatus: { type: Boolean, default: true },
      secondaryLogo: {},
      legalEntityName: { type: String },
      fitnessCertificateDetails: {
        type: [
          new Schema({
            fitnessCertificateName: { type: String },
            fitnessCertificateValidity: Date, // This field is non-mandatory
            fitnessCertificateDocuments: [{}],
            isExpired: { type: Boolean, default: false }, // Default value for isExpired
          }),
        ],
        default: [], // Set as an empty array by default
      },
    },
    {
      timestamps: true,
    }
  );
  schema.pre("save", sequentialIdMiddleware(mongooseClient, modelName));
  schema.index(
    { projectId: 1, inductionTrainingCode: 1 },
    { unique: true, collation: { locale: "en", strength: 2 } }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-project/src/models/labourcamps.model.js
const { first } = require("underscore");

module.exports = function (app) {
  const modelName = "labourcamps";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      campName: { type: String, required: true, trim: true },
      campAddress: { type: String, required: true, trim: true },
      projectId: { type: Schema.Types.ObjectId, required: true },
      projectName: { type: String, required: true },
      projectCode: { type: String, required: true },
      isOccupied: { type: Boolean, default: false },
      assignedTo: { type: String }, //labourCode of the labour assigned to this camp
      assignedToLabourName: { type: String },
      // assignedHistory: {},
      createdBy: { type: String },
      updatedBy: { type: String },
    },
    {
      timestamps: true,
    }
  );
  schema.index(
    { projectId: 1, campName: 1 },
    { unique: true, collation: { locale: "en", strength: 2 } }
  );

  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-project/src/models/mainareassubareas.model.js
module.exports = function (app) {
  const modelName = "mainareassubareas";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      projectId: { type: Schema.Types.ObjectId, required: true },
      area: { type: String, required: true, trim: true },
      areaType: {
        type: String,
        enum: ["Main Area", "Sub Area"],
        required: true,
      },
      areaTypeCode: { type: String, required: true },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
    },
    {
      timestamps: true,
    }
  );
  schema.index(
    { projectId: 1, areaTypeCode: 1 },
    { unique: true, collation: { locale: "en", strength: 2 } }
  );

  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-project/src/models/masterworkhours.model.js
// masterworkhours-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "masterworkhours";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      projectId: { type: Schema.Types.ObjectId, required: true },
      userCode: { type: String, required: true }, //uniquecode of inductee
      firstName: { type: String, required: true },
      middleName: { type: String, required: false },
      lastName: { type: String, required: true },
      category: { type: String, required: true },
      firstInTime: { type: Date },
      lastOutTime: { type: Date },
      workHours: { type: Number },
      workMinutes: { type: Number },
      isRegularized: { type: Boolean, default: false },
      isEdited: { type: Boolean, default: false },
      regularizedBy: {},
      frInVerified: { type: Boolean, default: false },
      frOutVerified: { type: Boolean, default: false },
      contactNumber: { type: String },
      geolocation: {
        locationAddress: { type: String },
        latitude: { type: String },
        longitude: { type: String },
        altitude: { type: String },
      },
      workDate: { type: Date },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
      contractorFirmName: { type: String },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-project/src/models/project.model.js
// project-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "project";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      projectId: { type: Schema.Types.ObjectId, required: true },
      projectName: {
        type: String,
        required: true,
      },
      projectCode: {
        type: String,
        required: true,
        unique: true,
      },
      zoneName: {
        type: String,
        required: true,
      },
      city: {
        type: String,
        required: true,
      },
      contactNumber: {
        type: String,
        required: true,
      },
      address: {
        type: String,
        required: true,
      },
      numberofBuildings: {
        type: Number,
        required: true,
      },
      status: {
        type: String,
        enum: {
          values: ["Active", "InActive"],
        },
        default: "Active",
      },
      photo: {},
      website: {
        type: String,
      },
      developerName: {
        type: String,
      },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-project/src/models/projectchecklists.model.js
// projectchecklists-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "projectchecklists";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      projectId: { type: Schema.Types.ObjectId, required: true },
      checklistName: { type: String, required: true },
      checklistCode: { type: String },
      activeChecklistDetailsCode: { type: String },
      activeVersion: { type: String },
      hasManagerActed: { type: Boolean, default: false },
      activeVersionPublishedDate: { type: Date },
      documentNo: { type: String },
      isActive: { type: Boolean, default: true },
      isReviewerAllowed: { type: Boolean, default: false },
      moduleName: { type: String },
      newChecklistType: { type: String },
      activationtypes: {
        type: [
          {
            label: {
              type: String,
            },
            value: {
              type: String,
            },
          },
        ],
      },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-project/src/models/projectclients.model.js
// projectclients-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "projectclients";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      projectId: { type: Schema.Types.ObjectId, required: true },
      clientCode: { type: String, required: true },
      firstName: { type: String, required: true },
      lastName: { type: String, required: true },
      profilePhoto: {
        type: new Schema({
          _id: false,
          fieldname: String,
          originalname: String,
          encoding: String,
          mimetype: String,
          destination: String,
          filename: String,
          path: String,
          size: Number,
        }),
      },
      gender: {
        type: String,
      },
      contactNumber: { type: String, required: true },
      emergencyContactName: { type: String, required: true },
      emergencyContactNumber: { type: String, required: true },
      isActive: { type: Boolean, required: true, default: true },
      projectCode: { type: String, required: true },
      projectName: { type: String, required: true },
      lastInductedOn: { type: Date },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-project/src/models/projectconsultants.model.js
// projectconsultants-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "projectconsultants";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      projectId: { type: Schema.Types.ObjectId, required: true },
      consultantCode: { type: String, required: true },
      firstName: { type: String, required: true },
      lastName: { type: String, required: true },
      profilePhoto: {
        type: new Schema({
          _id: false,
          fieldname: String,
          originalname: String,
          encoding: String,
          mimetype: String,
          destination: String,
          filename: String,
          path: String,
          size: Number,
        }),
      },
      gender: {
        type: String,
      },
      contactNumber: { type: String, required: true },
      emergencyContactName: { type: String, required: true },
      emergencyContactNumber: { type: String, required: true },
      isActive: { type: Boolean, required: true, default: true },
      projectCode: { type: String, required: true },
      projectName: { type: String, required: true },
      lastInductedOn: { type: Date },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-project/src/models/projectcontractors.model.js
// projectcontractors-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "projectcontractors";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      projectId: { type: Schema.Types.ObjectId, required: true },
      contractorCode: { type: String, required: true },
      firstName: { type: String, required: true },
      lastName: { type: String, required: true },
      profilePhoto: {
        type: new Schema({
          _id: false,
          fieldname: String,
          originalname: String,
          encoding: String,
          mimetype: String,
          destination: String,
          filename: String,
          path: String,
          size: Number,
        }),
      },
      gender: {
        type: String,
      },
      contractorFirmDetails: {},
      contactNumber: { type: String, required: true },
      emergencyContactName: { type: String, required: true },
      emergencyContactNumber: { type: String, required: true },
      isActive: { type: Boolean, required: true, default: true },
      lastInductedOn: { type: Date },
      projectCode: { type: String, required: true },
      projectName: { type: String, required: true },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-project/src/models/projectgovernmentofficials.model.js
// projectgovernmentofficials-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "projectgovernmentofficials";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      projectId: { type: Schema.Types.ObjectId, required: true },
      governmentofficialCode: { type: String, required: true },
      firstName: { type: String, required: true },
      lastName: { type: String, required: true },
      profilePhoto: {
        type: new Schema({
          _id: false,
          fieldname: String,
          originalname: String,
          encoding: String,
          mimetype: String,
          destination: String,
          filename: String,
          path: String,
          size: Number,
        }),
      },
      gender: {
        type: String,
      },
      contactNumber: { type: String, required: true },
      emergencyContactName: { type: String, required: true },
      emergencyContactNumber: { type: String, required: true },
      isActive: { type: Boolean, required: true, default: true },
      projectCode: { type: String, required: true },
      projectName: { type: String, required: true },
      lastInductedOn: { type: Date },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-project/src/models/projectlabours.model.js
// projectlabours-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "projectlabours";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;

  const fitnessCertificateSchema = new Schema({
    fitnessCertificateCode: { type: String },
    fitnessCertificateName: { type: String },
    fitnessCertificateValidity: Date, // This field is non-mandatory
    fitnessCertificateAddedAt: Date,
    fitnessCertificateSource: { type: String },
    isLabourUnfit: { type: Boolean },
    fitnessCertificateDocuments: [{}],
    isExpired: { type: Boolean, default: false }, // Default value for isExpired
  });

  // NEW: Schema for a single Dependant (Copied from labours-model.js)
  const dependantSchema = new Schema(
    {
      dependantName: { type: String, required: true },
      dateOfBirth: { type: Date, required: true }, // Storing DOB as a Date object
      gender: { type: String, required: true },
      // Stores the selected relation name (e.g., "Spouse") from the dropdown
      relation: { type: String, required: true },
      otherRelation: { type: String, required: false },
      idProofType: { type: String, required: false },
      idProofNumber: { type: String, required: false },
      contactNumber: { type: String, required: false },
      accessCrecheSchooling: { type: Boolean, default: false },
    },
    { _id: false }
  ); // _id: false prevents Mongoose from creating an _id for each sub-document

  const schema = new Schema(
    {
      projectId: { type: Schema.Types.ObjectId, required: true },
      labourCode: { type: String, required: true },
      firstName: { type: String, required: true },
      middleName: { type: String, required: false },
      lastName: { type: String, required: true },
      profilePhoto: {
        type: new Schema({
          _id: false,
          fieldname: String,
          originalname: String,
          encoding: String,
          mimetype: String,
          destination: String,
          filename: String,
          path: String,
          size: Number,
        }),
      },
      contactNumber: { type: String, required: true },
      violationCount: { type: Number, default: 0 },
      labourCreatedAt: Date,
      labourUpdatedAt: Date,
      emergencyContactName: { type: String },
      emergencyContactNumber: { type: String },
      isActive: { type: Boolean, required: true, default: true },
      contractorFirmDetails: {},
      trade: {
        type: new Schema({
          _id: false,
          tradeName: String,
          tradeCode: String,
          skillLevel: String,
        }),
        required: true,
      },
      projectCode: { type: String, required: true },
      projectName: { type: String, required: true },
      activationStatusHistory: {
        type: [
          {
            _id: false,
            status: { type: Boolean },
            deActivationReason: String,
            deactivationRemark: String,
            actionTakenBy: { type: Schema.Types.ObjectId, ref: "users" },
            actionTakenAt: { type: Date },
          },
        ],
      },
      gender: {
        type: String,
      },
      dateOfBirth: { type: Date }, // NEW: Added from the master labour model

      // NEW: Added dependant list
      dependants: {
        type: [dependantSchema],
        default: [],
      },

      // NEW: Address Management Fields (Added from the master labour model)
      currentAddressType: {
        type: String, // Stores the type: 'SAME_AS_PERMANENT', 'LABOUR_CAMP', or 'MANUAL_INPUT'
      },
      address: {
        type: String, // Stores the current address string, or Labour Camp ID/Name
      },
      labourCampQuarter: {
        type: {
          labourCampId: { type: Schema.Types.ObjectId }, // No ref
          quarterName: { type: String },
          labourCampProjectCode: { type: String }, // moved inside
        },
        default: null,
      },
      campAssignHistory: {
        type: [
          {
            campAssignedDate: { type: Date },
            campLeavingDate: { type: Date },
            campName: { type: String },
            campId: { type: String },
            campProjectCode: { type: String },
            campProjectName: { type: String },
          },
        ],
        default: [],
      },
      permanetAddress: {
        type: String, // The labour's permanent address
      },

      lastInductedOn: { type: Date },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
      idcardvalidity: { type: Date },
      idCardStatus: { type: Boolean },
      isIdCardGenerated: { type: Boolean },
      isLabourUnfit: { type: Boolean },
      fitnessStatusChangeSource: { type: String },
      validFitnessCertificateDetails: {
        type: [fitnessCertificateSchema],
        default: [], // Set as an empty array by default
      },
      expiredFitnessCertificateDetails: {
        type: [fitnessCertificateSchema],
        default: [], // Set as an empty array by default
      },
      updateHistory: [
        {
          _id: false,
          updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
          updatedAt: { type: Date, default: Date.now },
          changes: [
            {
              field: String,
              oldValue: Schema.Types.Mixed,
              newValue: Schema.Types.Mixed,
            },
          ],
        },
      ],
    },
    {
      timestamps: true,
    }
  );
  schema.index({ projectId: 1, labourCode: 1 }, { unique: true });

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-project/src/models/projectothercategories.model.js
// projectothercategories-model.js - A mongoose model
// 
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = 'projectothercategories';
  const mongooseClient = app.get('mongooseClient');
  const { Schema } = mongooseClient;
  const schema = new Schema( {
    projectId: { type: Schema.Types.ObjectId, required: true },
    othercategoryCode: { type: String, required: true },
    firstName: { type: String, required: true },
    lastName: { type: String, required: true },
    profilePhoto: {
      type: new Schema({
        _id: false,
        fieldname: String,
        originalname: String,
        encoding: String,
        mimetype: String,
        destination: String,
        filename: String,
        path: String,
        size: Number,
      }),
    },
    gender: {
      type: String,
    },
    contactNumber: { type: String, required: true },
    emergencyContactName: { type: String, required: true },
    emergencyContactNumber: { type: String, required: true },
    isActive: { type: Boolean, required: true, default: true },
    projectCode: { type: String, required: true },
    projectName: { type: String, required: true },
    lastInductedOn: { type: Date },
    createdBy: { type: Schema.Types.ObjectId, ref: "users" },
    updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
  }, {
    timestamps: true
  });

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
  
};

vsa-revamp-project/src/models/projectstaffs.model.js
// projectstaffs-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "projectstaffs";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      projectId: { type: Schema.Types.ObjectId, required: true },
      staffCode: { type: String, required: true },
      firstName: { type: String, required: true },
      lastName: { type: String, required: true },
      profilePhoto: {
        type: new Schema({
          _id: false,
          fieldname: String,
          originalname: String,
          encoding: String,
          mimetype: String,
          destination: String,
          filename: String,
          path: String,
          size: Number,
        }),
      },
      contactNumber: { type: String, required: true },
      type: { type: String, required: false },
      emergencyContactName: { type: String, required: false },
      emergencyContactNumber: { type: String, required: false },
      isActive: { type: Boolean, required: true, default: true },
      projectCode: { type: String, required: true },
      projectName: { type: String, required: true },
      lastInductedOn: { type: Date },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
      username: { type: String, required: false },
      violationCount: { type: Number, default: 0 },
      isApplicationUser: { type: Boolean, required: false, default: false },
      contractorFirmDetails: {
        contractorFirmName: String,
        contractorFirmCode: String,
        ctContactNumber: String,
      },
      contractorHistory: {
        type: [
          {
            contractorFirmName: String,
            contractorFirmCode: String,
            ctContactNumber: String,
          },
        ],
      },
      activationStatusHistory: {
        type: [
          {
            _id: false,
            status: { type: Boolean, default: true },
            deActivationReason: String,
            deactivationRemark: String,
            actionTakenBy: { type: Schema.Types.ObjectId, ref: "users" },
            actionTakenAt: { type: Date },
          },
        ],
      },
      gender: {
        type: String,
        enum: {
          values: ["MALE", "FEMALE", "OTHER", ""],
        },
        required: false,
      },
      // bloodGroup: { type: String },
      staffJoiningDate: { type: Date, required: false },
      staffDesignation: { type: String, required: false },
      staffType: { type: String, required: false },
      idcardvalidity: { type: Date },
      idCardStatus: { type: Boolean },
      isIdCardGenerated: { type: Boolean },
    },
    {
      timestamps: true,
    }
  );

  schema.index(
    { projectId: 1, staffCode: 1 },
    { unique: true, collation: { locale: "en", strength: 2 } }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-project/src/models/reportsemailconfigurations.model.js
// reportsemailconfigurations-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html

const trimStrings = require("../middleware/trimStrings");

// for more of what you can do here.
module.exports = function (app) {
  const modelName = "reportsemailconfigurations";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      projectId: { type: Schema.Types.ObjectId, required: true },
      email: { type: String, require: true },
      monthly: { type: Boolean, require: true, default: false },
      weekly: { type: Boolean, require: true, default: false },
    },
    {
      timestamps: true,
    }
  );
  schema.plugin(trimStrings);
  schema.index(
    { email: 1, projectId: 1 },
    {
      unique: true,
      collation: { locale: "en", strength: 2 },
    }
  );
  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-project/src/models/safehours.model.js
// safehours-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "safehours";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      hours: { type: Number },
      safehoursDate: {
        type: {
          month: { type: Number, required: true },
          year: { type: Number, required: true },
        },
        required: true,
      },
      projectId: { type: Schema.Types.ObjectId, required: true },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-project/src/models/safetyactionables.model.js
module.exports = function (app) {
  const modelName = "safetyactionables";
  const mongooseClient = app.get("mongooseClient");
  const sequentialIdMiddleware = require("../middleware/generatingSequentialIds");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      projectId: { type: Schema.Types.ObjectId, required: true },
      type: { type: String, required: true },
      sequentialId: { type: Number },
      categories: {
        type: [String],
        required: [false, "Categories must not be empty"],
        // validate: {
        //   validator: (value) => value.length > 0,
        //   message: "Categories must not be empty",
        // },
      },
      safetyActionableCode: { type: String, required: true },
      photos: {
        type: [
          {
            _id: false,
            fieldname: { type: String, required: true },
            originalname: { type: String, required: true },
            encoding: { type: String, required: true },
            mimetype: { type: String, required: true },
            destination: { type: String, required: true },
            filename: { type: String, required: true },
            path: { type: String, required: true },
            size: { type: Number, required: true },
          },
        ],
        required: true,
      },
      status: { type: String, required: true },
      details: { type: String, required: true },
      location: { type: String, required: false },
      turnAroundTime: { type: Date, required: false },
      projectName: { type: String, required: true },
      riskLevelDetails: {
        type: {
          _id: false,
          id: Schema.Types.ObjectId,
          riskLevel: { type: String, required: false },
        },
        required: false,
      },
      mainAreasofObservation: {
        type: [
          {
            _id: false,
            areaId: { type: Schema.Types.ObjectId },
            area: { type: String, required: true },
            areaType: { type: String, enum: ["Main Area"] },
          },
        ],
        default: [],
      },
      subAreasofObservation: {
        type: [
          {
            _id: false,
            areaId: { type: Schema.Types.ObjectId },
            area: String,
            areaType: { type: String, enum: ["Sub Area"] },
          },
        ],
        default: [],
      },
      sourceObservationDetails: {
        type: {
          _id: false,
          id: { type: Schema.Types.ObjectId },
          sourceObservation: { type: String },
        },
        default: {},
        required: true,
      },
      safetyActionableDocumentNumber: { type: String, required: false },
      assigneeDetails: {
        type: [
          {
            _id: false,
            currentAssignee: { type: Boolean, default: true },
            id: { type: Schema.Types.ObjectId },
            firstName: { type: String, required: true },
            lastName: { type: String, required: true },
            profilePic: {},
            designation: { type: String, required: true },
            userType: {
              type: String,
              enum: ["Internal", "External"],
              required: true,
            },
            contractorFirm: {},
            phoneNumber: { type: String },
          },
        ],
      },
      informedPeople: {
        type: [
          {
            _id: false,
            id: { type: Schema.Types.ObjectId },
            firstName: { type: String, required: true },
            lastName: { type: String, required: true },
            profilePic: {},
            designation: { type: String, required: true },
            userType: {
              type: String,
              enum: ["Internal", "External"],
              required: true,
            },
            contractorFirm: {},
            phoneNumber: { type: String },
          },
        ],
      },
      involvedPersons: {
        type: [
          {
            _id: false,
            id: { type: Schema.Types.ObjectId },
            userCategory: { type: String }, //APPUSER , STAFF , LABOUR
            userCode: { type: String }, // need to discuss with soham for this field
            firstName: { type: String, required: true },
            middleName: { type: String, required: false },
            lastName: { type: String, required: true },
            designation: { type: String, required: false },
            profilePic: {},
            userType: {
              type: String,
              required: false,
            },
            contractorFirm: {}, // contractorFirmCode need to discuss with soham
            phoneNumber: { type: String },
          },
        ],
      },
      source: {
        type: {
          _id: false,
          category: { type: String }, // webuser or mobileuser
          checklistId: { type: Schema.Types.ObjectId, ref: "answersheets" },
          checklistNo: { type: String },
        },
        required: true,
      },
      escalated: { type: Boolean, required: true, default: false },
      escalationLevel: { type: String, required: false, default: "" }, //need to confirm
      comments: { type: String },
      signature: {},
      signatureType: { type: String },
      fingerprint: {},
      createdBy: {
        type: {
          _id: false,
          id: { type: Schema.Types.ObjectId },
          firstName: { type: String, required: true },
          lastName: { type: String, required: true },
          profilePic: {},
          designation: { type: String, required: true },
          phoneNumber: { type: String },
        },
      },
      updatedBy: {
        type: {
          _id: false,
          id: { type: Schema.Types.ObjectId },
          firstName: { type: String, required: true },
          lastName: { type: String, required: true },
          profilePic: {},
          designation: { type: String, required: true },
          phoneNumber: { type: String },
        },
      },

      geolocation: {
        locationAddress: { type: String },
        latitude: { type: String },
        longitude: { type: String },
        altitude: { type: String },
      },
      auditData: {
        type: [
          {
            _id: false,
            status: { type: String, required: true },
            comments: { type: String },
            assigneeDetails: {
              type: [
                {
                  _id: false,
                  currentAssignee: { type: Boolean, default: true },
                  id: { type: Schema.Types.ObjectId },
                  firstName: { type: String, required: true },
                  lastName: { type: String, required: true },
                  profilePic: {},
                  designation: { type: String, required: true },
                  userType: {
                    type: String,
                    enum: ["Internal", "External"],
                    required: true,
                  },
                  contractorFirm: {},
                  phoneNumber: { type: String },
                },
              ],
            },
            updatedBy: {
              type: {
                _id: false,
                id: { type: Schema.Types.ObjectId },
                firstName: { type: String, required: true },
                lastName: { type: String, required: true },
                profilePic: {},
                designation: { type: String, required: true },
                phoneNumber: { type: String },
              },
            },
            geolocation: {
              locationAddress: { type: String },
              latitude: { type: String },
              longitude: { type: String },
              altitude: { type: String },
            },
            signature: {},
            signatureType: { type: String },
            fingerprint: {},
            updatedAt: { type: Date, required: true },
            details: { type: String },
            photos: {
              type: [
                {
                  _id: false,
                  fieldname: { type: String, required: true },
                  originalname: { type: String, required: true },
                  encoding: { type: String, required: true },
                  mimetype: { type: String, required: true },
                  destination: { type: String, required: true },
                  filename: { type: String, required: true },
                  path: { type: String, required: true },
                  size: { type: Number, required: true },
                },
              ],
            },
          },
        ],
        default: [],
      },
      secondaryLogo: {},
      legalEntityName: { type: String },
      recommendation: { type: String, required: false },
    },
    {
      timestamps: true,
    }
  );
  schema.pre("save", sequentialIdMiddleware(mongooseClient, modelName));
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-project/src/models/safetyreporthistory.model.js
// safetyreporthistory-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "safetyreporthistory";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      projectId: { type: Schema.Types.ObjectId, required: true },
      reportType: {
        type: String,
        enum: ["Automated", "Ad-hoc"],
        required: true,
      },
      frequency: { type: String, enum: ["Weekly", "Monthly"], required: false },
      recipientsEmailHistory: { type: [] },
      startDate: { type: Date },
      endDate: { type: Date },
      // isSearch: { type: Boolean, required: true, default: false },
      safetyReportDocument: { type: {} },
      createdBy: { type: {} },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-project/src/models/shifthours.model.js
// shifthours-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "shifthours";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      projectId: { type: Schema.Types.ObjectId, required: true },
      shiftHours: { type: Number, required: true },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-project/src/models/spotbulkupload.model.js
// spotbulkupload-model.js - A mongoose model
// 
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = 'spotbulkupload';
  const mongooseClient = app.get('mongooseClient');
  const { Schema } = mongooseClient;
  const schema = new Schema({
    text: { type: String, required: true }
  }, {
    timestamps: true
  });

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
  
};

vsa-revamp-project/src/models/spotchecklistconfigurations.model.js
// spotchecklistconfigurations-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "spotchecklistconfigurations";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      projectId: { type: Schema.Types.ObjectId, required: true },
      spotChecklistCode: { type: String, required: true },
      checklistCode: { type: String, required: true },
      checklistDetailsCode: { type: String, required: true },
      activeVersion: { type: String, required: true },
      spots: {
        type: [
          {
            _id: false,
            spotCode: { type: String, required: true },
            spotName: { type: String, required: true },
            groupCode: { type: String, required: true },
            groupName: { type: String, required: true },
          },
        ],
        validate: [
          (data) => Array.isArray(data) && data?.length,
          "At least one spot should be added.",
        ],
      },
      isActive: { type: Boolean, required: false, default: true },
      createdBy: {
        type: {
          _id: false,
          username: { type: String, required: true },
          firstName: { type: String, required: true },
          lastName: { type: String, required: true },
          profilePic: {},
          designation: { type: String, required: true },
          phoneNumber: { type: String },
        },
      },
      updatedBy: {
        type: {
          _id: false,
          username: { type: String, required: true },
          firstName: { type: String, required: true },
          lastName: { type: String, required: true },
          profilePic: {},
          designation: { type: String, required: true },
          phoneNumber: { type: String },
        },
      },
    },
    {
      timestamps: true,
    }
  );

  schema.index(
    {
      checklistCode: 1,
      checklistDetailsCode: 1,
      activeVersion: 1,
      spotChecklistCode: 1,
      projectId: 1,
    },
    {
      unique: true, // Specifies that the values in the indexed field must be unique
      collation: {
        locale: "en", // Specifies the locale for the collation (English)
        strength: 2, // Specifies the strength of the collation (secondary)
      },
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-project/src/models/spotgroups.model.js
// spotgroup-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html

const trimStrings = require("../middleware/trimStrings");

// for more of what you can do here.
module.exports = function (app) {
  const modelName = "spotgroup";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      projectId: { type: Schema.Types.ObjectId, required: true },
      groupName: { type: String, required: true },
      groupCode: { type: String, required: true },
      isActive: { type: Boolean, default: true },
      createdBy: {
        type: {
          _id: false,
          username: { type: String, required: true },
          firstName: { type: String, required: true },
          lastName: { type: String, required: true },
          profilePic: {},
          designation: { type: String, required: true },
          phoneNumber: { type: String },
        },
      },
      updatedBy: {
        type: {
          _id: false,
          username: { type: String, required: true },
          firstName: { type: String, required: true },
          lastName: { type: String, required: true },
          profilePic: {},
          designation: { type: String, required: true },
          phoneNumber: { type: String },
        },
      },
    },
    {
      timestamps: true,
    }
  );
  schema.index(
    { groupName: 1, groupCode: 1, projectId: 1 }, // Defines the index on the 'name' field in ascending order (1)
    {
      unique: true, // Specifies that the values in the indexed field must be unique
      collation: {
        locale: "en", // Specifies the locale for the collation (English)
        strength: 2, // Specifies the strength of the collation (secondary)
      },
    }
  );
  schema.plugin(trimStrings);
  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-project/src/models/spots.model.js
// spots-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html

// for more of what you can do here.
module.exports = function (app) {
  const modelName = "spots";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      projectId: { type: Schema.Types.ObjectId, required: true },
      spotName: { type: String, required: true },
      spotCode: { type: String, required: true },
      groupCode: { type: String, required: true },
      isActive: { type: Boolean, default: true },
      createdBy: {
        type: {
          _id: false,
          username: { type: String, required: true },
          firstName: { type: String, required: true },
          lastName: { type: String, required: true },
          profilePic: {},
          designation: { type: String, required: true },
          phoneNumber: { type: String },
        },
      },
      updatedBy: {
        type: {
          _id: false,
          username: { type: String, required: true },
          firstName: { type: String, required: true },
          lastName: { type: String, required: true },
          profilePic: {},
          designation: { type: String, required: true },
          phoneNumber: { type: String },
        },
      },
    },
    {
      timestamps: true,
    }
  );
  schema.pre("save", function (next) {
    this.spotName = this.spotName.replace(/\s+/g, " ");
    next();
  });

  schema.index(
    { spotName: 1, groupCode: 1, spotCode: 1, projectId: 1 }, // Defines the index on the 'name' field in ascending order (1)
    {
      unique: true, // Specifies that the values in the indexed field must be unique
      collation: {
        locale: "en", // Specifies the locale for the collation (English)
        strength: 2, // Specifies the strength of the collation (secondary)
      },
    }
  );
  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-project/src/models/taskalerts.model.js
// taskalerts-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "taskalerts";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      projectId: { type: Schema.Types.ObjectId, required: true },
      taskCode: { type: String, required: true },
      taskAlertCode: { type: String, required: true },
      alertDate: { type: Date, required: true }, //calculated alert date against task
      alertNumber: { type: Number, required: true },
      turnAroundTime: { type: Date },
      details: { type: String },
      alertRecipient: {
        username: { type: String, required: true },
      }, //required
      isAssignee: { type: Boolean, required: true, default: false },
      isAlertSent: { type: Boolean, required: true, default: false },
      isActive: { type: Boolean, required: true, default: true },
      createdBy: { type: String, required: true },
      updatedBy: { type: String },
    },
    {
      timestamps: true,
    }
  );
  schema.index(
    { projectId: 1, taskAlertCode: 1 },
    { unique: true, collation: { locale: "en", strength: 2 } }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-project/src/models/taskconversations.model.js
// taskconversations-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "taskconversations";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      projectId: { type: Schema.Types.ObjectId, required: true },
      taskCode: { type: String, required: true },
      attachments: {
        type: [
          {
            _id: false,
            fieldname: { type: String, required: true },
            originalname: { type: String, required: true },
            encoding: { type: String, required: true },
            mimetype: { type: String, required: true },
            destination: { type: String, required: true },
            filename: { type: String, required: true },
            path: { type: String, required: true },
            size: { type: Number, required: true },
          },
        ],
      },
      message: { type: String },
      taskStatus: { type: String },
      createdBy: {
        type: {
          _id: false,
          username: { type: String, required: true },
          firstName: { type: String, required: true },
          lastName: { type: String, required: true },
          profilePic: {},
          designation: { type: String, required: true },
          phoneNumber: { type: String },
        },
      },
      updatedBy: {
        type: {
          _id: false,
          username: { type: String, required: true },
          firstName: { type: String, required: true },
          lastName: { type: String, required: true },
          profilePic: {},
          designation: { type: String, required: true },
          phoneNumber: { type: String },
        },
      },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-project/src/models/tasks.model.js
// tasks-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "tasks";
  const mongooseClient = app.get("mongooseClient");
  const sequentialIdMiddleware = require("../middleware/generatingSequentialIds");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      projectId: { type: Schema.Types.ObjectId, required: true },
      sequentialId: { type: Number },
      taskCode: { type: String, required: true },
      checklistId: { type: String, required: true },
      checklistCode: { type: String, required: true },
      checklistDetailsCode: { type: String, required: true },
      checkPointCode: { type: String, required: true },
      responseFieldCode: { type: String },
      taskTitle: { type: String, required: true },
      details: { type: String },
      remark: { type: String },
      priority: { type: String, enum: ["HIGH", "MEDIUM", "LOW", "NONE"] },
      turnAroundTime: { type: Date },
      assigneeDetails: {
        type: [
          {
            _id: false,
            currentAssignee: { type: Boolean, default: true },
            username: { type: String, required: true },
            firstName: { type: String, required: true },
            lastName: { type: String, required: true },
            profilePic: {},
            designation: { type: String, required: true },
            userType: {
              type: String,
              enum: ["Internal", "External"],
              required: true,
            },
            contractorFirm: {},
            phoneNumber: { type: String },
          },
        ],
      },
      isDeleted: { type: Boolean, default: false },
      reasonOfDeletion: { type: String },
      deletedOn: { type: Date },
      deletedBy: {},
      location: { type: String },
      photos: {
        type: [
          {
            _id: false,
            fieldname: { type: String, required: true },
            originalname: { type: String, required: true },
            encoding: { type: String, required: true },
            mimetype: { type: String, required: true },
            destination: { type: String, required: true },
            filename: { type: String, required: true },
            path: { type: String, required: true },
            size: { type: Number, required: true },
          },
        ],
      },
      createAlert: { type: Boolean, required: true },
      alertDateAndTime: { type: Date },
      alertRecipients: {
        type: [
          {
            _id: false,
            username: { type: String, required: true },
            firstName: { type: String, required: true },
            lastName: { type: String, required: true },
            isActive: { type: Boolean, required: true, default: true },
            isAssignee: { type: Boolean, required: true, default: false },
            profilePic: {},
            designation: { type: String, required: true },
            userType: {
              type: String,
              enum: ["Internal", "External"],
              required: true,
            },
            contractorFirm: {},
            phoneNumber: { type: String },
          },
        ],
      },
      alertCount: { type: Number },
      alertGaps: { type: Number },
      alertNumber: { type: Number, required: true, default: 0 },
      latestAlertAt: { type: Date }, //for task alert date
      status: {
        type: String,
        required: true,
        enum: [
          "DRAFT",
          "OPEN",
          "INPROGRESS",
          "CANCELLED",
          "COMPLETED",
          "REOPEN",
          "CLOSED",
        ],
      },
      statusHistory: { type: [] },
      checklistName: { type: String, required: true },
      version: { type: String, required: true },
      isOffline: { type: Boolean, default: false },
      isDelayed: { type: Boolean, default: false },
      createdAtOffline: { type: Date },
      actualTurnAroundTimeInDays: { type: Number },
      createdAt: { type: Date },
      updatedAt: { type: Date },
      createdBy: {
        type: {
          _id: false,
          username: { type: String, required: true },
          firstName: { type: String, required: true },
          lastName: { type: String, required: true },
          profilePic: {},
          designation: { type: String, required: true },
          phoneNumber: { type: String },
        },
      },
      updatedBy: {
        type: {
          _id: false,
          username: { type: String, required: true },
          firstName: { type: String, required: true },
          lastName: { type: String, required: true },
          profilePic: {},
          designation: { type: String, required: true },
          phoneNumber: { type: String },
        },
      },
      secondaryLogo: {},
      legalEntityName: { type: String },
    },
    {
      timestamps: true,
    }
  );
  schema.pre("save", sequentialIdMiddleware(mongooseClient, modelName));
  schema.index(
    { projectId: 1, taskCode: 1 },
    { unique: true, collation: { locale: "en", strength: 2 } }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-project/src/models/taskturnaroundtimeconfigurations.model.js
// taskturnaroundtimeconfigurations-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "taskturnaroundtimeconfigurations";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      projectId: { type: Schema.Types.ObjectId, required: true },
      priority: { type: String, enum: ["HIGH", "MEDIUM", "LOW"] },
      hours: { type: Number },
    },
    {
      timestamps: true,
    }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-project/src/models/toolboxtrainings.model.js
// toolboxtrainings-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.
module.exports = function (app) {
  const modelName = "toolboxtrainings";
  const mongooseClient = app.get("mongooseClient");
  const sequentialIdMiddleware = require("../middleware/generatingSequentialIds");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      projectId: { type: Schema.Types.ObjectId, required: true },
      sequentialId: { type: Number },
      name: { type: String, required: true },
      workPermitDetails: {
        id: { type: Schema.Types.ObjectId, ref: "workpermits" },
        name: { type: String },
        workPermitCode: { type: String },
      },
      activityDetails: {
        id: { type: Schema.Types.ObjectId },
        name: { type: String },
        toolboxDocumentVersionNumber: { type: String, required: false },
      },
      projectDetails: {
        name: { type: String },
        code: { type: String },
      },
      traineesList: [
        {
          type: new mongooseClient.Schema({
            _id: false,
            userid: {
              type: Schema.Types.ObjectId,
              required: true,
            },
            traineeCode: { type: String },
            staffType: { type: String },
            category: { type: String },
            signatureType: { type: String },
            tarineeSignature: {
              filepath: { type: String },
              filename: { type: String },
            },
            isSignatureByTrainee: { type: Boolean },
            signatureOf: { type: String, default: null },
            signatureBy: { type: Schema.Types.ObjectId },
            trade: {
              tradeCode: { type: String, default: null },
              tradeName: { type: String, default: null },
              skillLevel: { type: String, default: null },
            },
            contractorFirm: { type: String },
            profilePic: {},
            firstName: String,
            middleName: String,
            lastName: String,
            aadharNo: String,
            gender: {
              type: String,
            },
            phoneNumber: { type: String },
          }),
        },
      ],
      trainingDetails: { type: String },
      instructionsDetailsList: [
        {
          type: new mongooseClient.Schema({
            _id: false,
            id: { type: Schema.Types.ObjectId },
            instruction: { type: String },
          }),
        },
      ],
      status: { type: String, required: true },
      groupPhotos: {
        type: [
          {
            type: new mongooseClient.Schema({
              _id: false,
              fieldname: String,
              originalname: String,
              encoding: String,
              mimetype: String,
              destination: String,
              filename: String,
              path: String,
              size: Number,
            }),
          },
        ],
        default: [],
      },
      createrDetails: {
        id: { type: Schema.Types.ObjectId },
        firstName: { type: String },
        lastName: { type: String },
        designation: { type: String },
        profilePic: {},
        createrSignature: {
          filepath: { type: String },
          filename: { type: String },
        },
        signatureType: { type: String },
        geolocation: {
          locationAddress: { type: String },
          latitude: { type: String },
          longitude: { type: String },
          altitude: { type: String },
        },
        phoneNumber: { type: String },
      },
      reviewerDetails: {
        id: { type: Schema.Types.ObjectId },
        firstName: { type: String },
        lastName: { type: String },
        designation: { type: String },
        profilePic: {},
        signatureType: { type: String },
        reviewerSignature: {
          filepath: { type: String },
          filename: { type: String },
        },
        geolocation: {
          locationAddress: { type: String },
          latitude: { type: String },
          longitude: { type: String },
          altitude: { type: String },
        },
        phoneNumber: { type: String },
      },
      comments: { type: String },
      currentActivityDocument: {
        type: [
          {
            type: new mongooseClient.Schema({
              _id: false,
              id: {
                type: Schema.Types.ObjectId,
              },
              document: { type: String },
              documentObject: {},
            }),
          },
        ],
        default: [],
      },
      closedDate: { type: Date },
      isOffline: { type: Boolean, default: false },
      createdAtOffline: { type: Date },
      syncDateTime: { type: Date },
      toolboxtrainingCode: { type: String },
      traineeCount: { type: Number },
      createdBy: {
        type: new mongooseClient.Schema({
          id: {
            type: Schema.Types.ObjectId,
          },
          firstName: { type: String, required: true },
          lastName: { type: String, required: true },
          profilePic: {},
          designation: { type: String },
        }),
      },
      updatedBy: {
        type: new mongooseClient.Schema({
          id: {
            type: Schema.Types.ObjectId,
          },
          firstName: { type: String, required: true },
          lastName: { type: String, required: true },
          profilePic: {},
          designation: { type: String },
        }),
      },
      secondaryLogo: {},
      legalEntityName: { type: String },
    },
    {
      timestamps: true,
    }
  );
  schema.pre("save", sequentialIdMiddleware(mongooseClient, modelName));
  schema.index(
    { projectId: 1, toolboxtrainingCode: 1 },
    { unique: true, collation: { locale: "en", strength: 2 } }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-project/src/models/userrole.model.js
// userrole-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html

const { uniq } = require("lodash");

// for more of what you can do here.
module.exports = function (app) {
  const modelName = "userrole";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      projectId: { type: Schema.Types.ObjectId, required: true },
      username: { type: String, required: true },
      roleCode: { type: String, required: true },
      roleName: { type: String, required: true },
      isActive: { type: Boolean, default: true },
    },
    {
      timestamps: true,
    }
  );
  schema.index(
    { projectId: 1, username: 1 },
    { unique: true, collation: { locale: "en", strength: 2 } }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-project/src/models/violationcasedetails.model.js
// violationcasedetails-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html

// for more of what you can do here.
module.exports = function (app) {
  const modelName = "violationcasedetails";
  const mongooseClient = app.get("mongooseClient");
  const sequentialIdMiddleware = require("../middleware/generatingSequentialIds");
  const { Schema } = mongooseClient;
  const schema = new Schema(
    {
      projectId: { type: Schema.Types.ObjectId, required: true },
      // common caseId
      sequentialId: { type: Number },
      caseCodeId: { type: String, required: true },
      status: { type: String }, // pending / under review / reviewed /cancelled
      violationDetails: [{ type: String }], // violation Details
      lastUpdateViolationHistory: {
        type: new mongooseClient.Schema({
          _id: false,
          id: {
            type: Schema.Types.ObjectId,
          },
          firstName: { type: String },
          lastName: { type: String },
          signature: {},
          designation: { type: String },
          signatureType: { type: String },
          datetime: { type: Date },
        }),
      },
      makerInfo: {
        type: new mongooseClient.Schema({
          _id: false,
          id: {
            type: Schema.Types.ObjectId,
          },
          firstName: { type: String },
          lastName: { type: String },
          phoneNumber: { type: String },
          contractorfirm: { type: String },
          profilePic: {},
          designation: { type: String },
          geolocation: {},
          makerSignature: {},
          makerSignatureType: { type: String },
          datetime: { type: Date },
        }),
      }, // Maker Information ...
      contractorFirmInfo: [
        {
          type: new mongooseClient.Schema({
            _id: false,
            contractorfirmName: { type: String },
            isRaisedDebitNote: { type: Boolean, required: false }, // isDebitNoteRaised
            ctContactNumber: { type: String },
            contractorFirmCode: { type: String },
            noticeId: { type: String },
            noticeObjectId: { type: Schema.Types.ObjectId },
            violationCount: { type: String },
            involvedPerson: [
              {
                type: new mongooseClient.Schema({
                  _id: false,
                  id: {
                    type: Schema.Types.ObjectId,
                  },
                  firstName: { type: String },
                  lastName: { type: String },
                  phoneNumber: { type: String },
                  profilePic: {},
                  violationCount: { type: String },
                  category: { type: String },
                  categoryUniqueCode: { type: String },
                  designation: { type: String },
                  trade: { type: String }
                }),
              },
            ],
            amount: { type: Number },
            comment: { type: String },
            remark: { type: String },
            action: { type: String },
            lastEditedByHistory: {},
          }),
        },
      ], // Contractorfirm Information ...
      // contractorfirmLastUpdateHistory: {}, //it for update info while edit
      locationOfViolation: { type: String }, // location
      severityOfViolation: { type: String }, // notice taken by admin
      photos: {
        type: [
          {
            type: new mongooseClient.Schema({
              _id: false,
              fieldname: String,
              originalname: String,
              encoding: String,
              mimetype: String,
              destination: String,
              filename: String,
              path: String,
              size: Number,
            }),
          },
        ],
        default: [],
      }, // photos
      receiverDetails: [
        {
          type: new mongooseClient.Schema({
            _id: false,
            id: {
              type: Schema.Types.ObjectId,
            },
            firstName: { type: String },
            lastName: { type: String },
            phoneNumber: { type: String },
            contractorfirm: { type: String },
            profilePic: {},
            designation: { type: String },
            receiverType: { type: String },
            geolocation: {},
            userCode: { type: String },
            receiverSignature: {},
            receiverSignatureType: { type: String },
            datetime: { type: Date },
          }),
        },
      ], //receivers
      attachedSafetyactionable: {
        type: new mongooseClient.Schema({
          _id: false,
          id: {
            type: Schema.Types.ObjectId,
          },
          safetyactionableCode: { type: String },
        }),
      }, // attached safetyactionables
      checkersDetailsHistory: [
        {
          type: new mongooseClient.Schema({
            _id: false,
            id: {
              type: Schema.Types.ObjectId,
            },
            firstName: { type: String },
            lastName: { type: String },
            phoneNumber: { type: String },
            assignDebitNotecontractorfirm: { type: String },
            profilePic: {},
            designation: { type: String },
            geolocation: {},
            datetime: { type: Date },
            approverSignature: {},
            approverSignatureType: { type: String },
            action: { type: String },
            comment: { type: String },
            remark: { type: String },
          }),
        },
      ], // checkers Details History
      secondaryLogo: {},
      legalEntityName: { type: String },
    },
    {
      timestamps: true,
    }
  );
  schema.pre("save", sequentialIdMiddleware(mongooseClient, modelName));

  schema.index(
    { projectId: 1, caseCodeId: 1 },
    { unique: true, collation: { locale: "en", strength: 2 } }
  );
  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};

vsa-revamp-project/src/models/workpermitcheckers.model.js
module.exports = function (app) {
  const modelName = "workpermitcheckers";
  const mongooseClient = app.get("mongooseClient");
  const { Schema } = mongooseClient;

  const schema = new Schema(
    {
      projectId: { type: Schema.Types.ObjectId, required: true },
      firstName: { type: String, required: true },
      lastName: { type: String, required: true },
      phoneNumber: { type: String },
      userId: { type: Schema.Types.ObjectId, ref: "users", required: true },
      workpermitCode: {
        type: String,
        ref: "workpermits",
        required: true,
      },
      isActive: { type: Boolean, default: true },
      action: { type: String, required: true },
      sequence: { type: Number },
      isCurrentCheckerForWP: { type: Boolean, default: false },
      hasActed: { type: Boolean, default: false },
      isCurrentCheckerForTimeExtension: { type: Boolean, default: false },
      actionForTimeExtension: { type: String },
      profilePic: {
        type: {
          _id: false,
          fieldname: String,
          originalname: String,
          encoding: String,
          mimetype: String,
          destination: String,
          filename: String,
          path: String,
          size: String,
        },
      },
      lastUpdatedstatusDate: { type: Date },
      designation: { type: String, required: true },
      createdBy: { type: Schema.Types.ObjectId, ref: "users" },
      updatedBy: { type: Schema.Types.ObjectId, ref: "users" },
    },
    {
      timestamps: true,
    }
  );

  //  PERFORMANCE INDEXES
  schema.index({
    projectId: 1,
    userId: 1,
    isActive: 1,
    isCurrentCheckerForWP: 1,
    isCurrentCheckerForTimeExtension: 1,
    hasActed: 1,
    workpermitCode: 1,
  });

  schema.index({
    projectId: 1,
    workpermitCode: 1,
  });

  schema.index({
    projectId: 1,
    userId: 1,
  });

  // Avoid overwrite error in watch mode
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }

  return mongooseClient.model(modelName, schema);
};

vsa-revamp-project/src/models/workpermits.model.js
// workpermits-model.js - A mongoose model
//
// See http://mongoosejs.com/docs/models.html
// for more of what you can do here.

module.exports = function (app) {
  const modelName = "workpermits";
  const mongooseClient = app.get("mongooseClient");
  const sequentialIdMiddleware = require("../middleware/generatingSequentialIds");
  const { Schema } = mongooseClient;

  const schema = new Schema(
    {
      projectId: { type: Schema.Types.ObjectId, required: true },
      workpermitCode: { type: String, required: true },
      sequentialId: { type: Number },
      name: { type: String, required: true },
      category: { type: String, required: true },
      workpermitDocumentNumber: { type: String, required: false },
      description: { type: String },
      isSequenced: { type: Boolean, required: true },
      isDeleted: { type: Boolean, default: false },
      reasonOfDeletion: { type: String },
      deletedOn: { type: Date },
      deletedBy: {},
      toolboxTrainings: {
        type: [
          {
            type: new mongooseClient.Schema({
              _id: false,
              name: { type: String, required: true },
              toolboxTrainingCode: { type: String, required: true },
            }),
          },
        ],
      },
      mainArea: {
        type: [
          {
            type: new mongooseClient.Schema({
              _id: false,
              name: { type: String, required: true },
              mainAreaCode: { type: String, required: true },
            }),
          },
        ],
      },
      subArea: {
        type: [
          {
            type: new mongooseClient.Schema({
              _id: false,
              name: { type: String, required: true },
              subAreaCode: { type: String, required: true },
            }),
          },
        ],
      },
      workStartDatetime: { type: Date, required: true },
      workEndDatetime: { type: Date, required: true },
      extendTo: { type: Date, default: null },
      timeExtensionStatus: { type: String },
      documents: [{}],
      hazards: [
        {
          type: new mongooseClient.Schema({
            _id: false,
            name: { type: String, required: true },
            hazardCode: { type: String, required: true },
          }),
        },
      ],
      additionalHazard: { type: String, required: false },
      precautions: [
        {
          type: new mongooseClient.Schema({
            _id: false,
            name: { type: String, required: true },
            precautionCode: { type: String, required: true },
            remark: { type: String },
            precautionAttachment: {},
          }),
        },
      ],
      precautionCommonAttachments: {},
      additionalPrecaution: { type: String, required: false },
      additionalPrecautionRemark: { type: String, required: false },
      additionalPrecautionAttachment: {},
      ppes: [
        {
          type: new mongooseClient.Schema({
            _id: false,
            name: { type: String, required: true },
            ppeCode: { type: String, required: true },
          }),
        },
      ],
      additionalPPE: { type: String, required: false },
      toolsAndEquipments: [
        {
          type: new mongooseClient.Schema({
            _id: false,
            name: { type: String, required: true },
            toolAndEquipmentCode: { type: String, required: true },
          }),
        },
      ],
      additionalToolsAndEquipments: { type: String, required: false },
      status: { type: String, required: true },
      statusHistory: {
        type: [
          {
            type: new mongooseClient.Schema({
              _id: false,
              workpermitStatus: { type: String },
              id: { type: Schema.Types.ObjectId, require: true, ref: "users" },
              firstName: { type: String, required: true },
              lastName: { type: String, required: true },
              designation: { type: String, required: true },
              profilePic: {},
              signature: {},
              signatureType: { type: String },
              geolocation: {
                type: new mongooseClient.Schema({
                  _id: false,
                  locationAddress: { type: String },
                  latitude: { type: String },
                  longitude: { type: String },
                  altitude: { type: String },
                }),
              },
              comment: { type: String },
              action: { type: String },
              updatedDate: { type: Date },
              photos: [],
              phoneNumber: { type: String },
            }),
          },
        ],
      },
      comment: { type: String },
      isOffline: { type: Boolean, default: false },
      createdAtOffline: { type: Date },
      syncDateTime: { type: Date },
      photos: [{}],
      createdBy: {
        type: new mongooseClient.Schema({
          _id: false,
          id: { type: Schema.Types.ObjectId, require: true, ref: "users" },
          firstName: { type: String, required: true },
          lastName: { type: String, required: true },
          designation: { type: String, required: true },
          profilePic: {},
          signature: {},
          signatureType: { type: String },
          geolocation: {
            type: new mongooseClient.Schema({
              _id: false,
              locationAddress: { type: String },
              latitude: { type: String },
              longitude: { type: String },
              altitude: { type: String },
            }),
          },
          phoneNumber: { type: String },
        }),
      },
      updatedBy: {
        type: new mongooseClient.Schema({
          _id: false,
          id: { type: Schema.Types.ObjectId, require: true, ref: "users" },
          firstName: { type: String, required: true },
          lastName: { type: String, required: true },
          designation: { type: String, required: true },
          profilePic: {},
          signature: {},
          signatureType: { type: String },
          geolocation: {
            type: new mongooseClient.Schema({
              _id: false,
              locationAddress: { type: String },
              latitude: { type: String },
              longitude: { type: String },
              altitude: { type: String },
            }),
          },
          phoneNumber: { type: String },
        }),
      },
      timeExtensionStatusHistory: [
        {
          status: { type: String }, //open or rejected / accepted,
          extendTo: { type: Date },
          reason: { type: String },
          updatedBy: {
            firstName: { type: String },
            lastName: { type: String },
            _id: { type: Schema.Types.ObjectId },
            designation: { type: String },
            profilePic: { type: Object },
            updateOn: { type: Date },
            phoneNumber: { type: String },
          },
          _id: false,
        },
      ],
      secondaryLogo: {},
      legalEntityName: { type: String },
      contractorFirmDetails: [
        {
          type: new mongooseClient.Schema({
            _id: false,
            contractorFirm: { type: String },
            contractorFirmCode: { type: String },
            ctContactNumber: { type: String },
            gstInNumber: { type: String },
            emailId: { type: String },
          }),
        },
      ],
      numberOfWorkers: { type: String },
    },
    {
      timestamps: true,
    }
  );
  schema.pre("save", sequentialIdMiddleware(mongooseClient, modelName));
  schema.index(
    { projectId: 1, workpermitCode: 1 },
    { unique: true, collation: { locale: "en", strength: 2 } }
  );

  // This is necessary to avoid model compilation errors in watch mode
  // see https://mongoosejs.com/docs/api/connection.html#connection_Connection-deleteModel
  if (mongooseClient.modelNames().includes(modelName)) {
    mongooseClient.deleteModel(modelName);
  }
  return mongooseClient.model(modelName, schema);
};
